<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DNATA Employee Portal</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.12.2/lottie.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <style>
        
        /* Fixed Header Improvements */
.fixed-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 15px;
    box-sizing: border-box;
    width: calc(100% - 40px); /* Account for left/right margins */
    max-width: 500px;
    white-space: nowrap;
    overflow: hidden;
}

.fixed-header h1 {
    font-size: 1rem;
    margin: 0;
    flex-shrink: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    padding-right: 10px;
}

.header-actions {
    display: flex;
    align-items: center;
    flex-shrink: 0;
    gap: 8px;
}

.header-user-info {
    display: flex;
    align-items: center;
    gap: 8px;
}

.header-user-avatar {
    flex-shrink: 0;
    width: 32px;
    height: 32px;
}

.header-logout-btn {
    white-space: nowrap;
    padding: 5px 10px;
    font-size: 0.8rem;
}

/* Back button adjustments */
.back-button {
    margin-right: 10px;
    flex-shrink: 0;
}

/* Mobile-specific adjustments */
@media (max-width: 576px) {
    .fixed-header {
        width: calc(100% - 30px);
        padding: 8px 10px;
    }
    
    .fixed-header h1 {
        font-size: 0.9rem;
    }
    
    .header-user-avatar {
        width: 28px;
        height: 28px;
    }
    
    .header-logout-btn {
        padding: 4px 8px;
        font-size: 0.7rem;
    }
    
    .header-logout-btn i {
        margin-right: 3px;
    }
}

/* Very small screens */
@media (max-width: 400px) {
    .fixed-header h1 {
        font-size: 0.8rem;
    }
    
    .header-logout-btn span {
        display: none;
    }
    
    .header-logout-btn i {
        margin-right: 0;
    }
}

/* Prevent layout shift */
.fixed-header > * {
    flex-shrink: 0;
}

/* Ensure header stays on one line */
.fixed-header {
    line-height: 1.2;
}
        /* Additional CSS for Fixed Icons and Smooth Scrolling */

/* Fixed floating icons that stay in place during scroll */
.floating-icon {
    position: fixed;
    will-change: transform;
    z-index: 999; /* Below header but above content */
}

/* Specific positions for each floating icon */
.floating-icon:nth-child(1) {
    top: 15%;
    left: 5%;
    animation-delay: 0s;
}

.floating-icon:nth-child(2) {
    top: 15%;
    right: 5%;
    animation-delay: 1s;
}

.floating-icon:nth-child(3) {
    bottom: 15%;
    left: 5%;
    animation-delay: 2s;
}

.floating-icon:nth-child(4) {
    bottom: 15%;
    right: 5%;
    animation-delay: 3s;
}

/* Smooth scrolling for all scrollable containers */
body,
.dashboard-body,
.fullscreen-content,
.chat-messages,
.profile-modal-body {
    -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
    scroll-behavior: smooth;
    overscroll-behavior-y: contain; /* Prevent overscroll glow/bounce */
}

/* Prevent layout shift on mobile */
html {
    overflow-x: hidden;
    width: 100%;
}

body {
    position: relative;
    width: 100%;
    overflow-x: hidden;
    -webkit-text-size-adjust: 100%; /* Prevent font scaling in landscape */
}

/* Enhanced mobile UI/UX */
@media (max-width: 576px) {
    /* Larger tap targets for mobile */
    .dashboard-icon {
        width: 55px;
        height: 55px;
        margin: 0 8px;
    }

    /* Better spacing for mobile */
    .dashboard-body {
        padding: 15px;
    }

    /* Improved form controls */
    .form-control {
        padding: 14px 15px 14px 45px;
        font-size: 16px; /* Larger text for mobile */
    }

    /* Better button sizing */
    .btn {
        padding: 14px;
    }

    /* Prevent zoom on input focus */
    input, select, textarea {
        font-size: 16px;
    }

    /* Fixed header adjustments */
    .fixed-header {
        width: calc(100% - 40px);
        left: 20px;
        transform: none;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
    }

    /* Fullscreen content adjustments */
    .fullscreen-content {
        padding-top: 70px; /* Account for fixed header */
    }

    /* Chat input improvements */
    .chat-input-container {
        padding: 8px;
    }

    .chat-input {
        font-size: 16px;
        padding: 12px 15px;
    }

    /* Message bubbles */
    .message {
        max-width: 85%;
        padding: 12px 15px;
    }

    /* Hide floating icons on very small screens */
    @media (max-width: 400px) {
        .floating-icon {
            display: none;
        }
    }
}

/* Performance optimizations */
* {
    -webkit-tap-highlight-color: transparent; /* Remove tap highlight */
    backface-visibility: hidden;
}

/* Prevent scrolling when modal is open */
body.modal-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
    height: 100%;
}

/* Break alert modal styling */
.break-alert-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(5px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.break-alert-overlay.show {
    opacity: 1;
}

.break-alert-modal {
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.3s ease;
    width: 90%;
    max-width: 400px;
}

.break-alert-modal.show {
    transform: translateY(0);
    opacity: 1;
}

.break-alert-content {
    background: white;
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
}

.break-alert-header {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    justify-content: center;
}

.break-alert-icon {
    margin-right: 10px;
    color: var(--warning);
    font-size: 1.5rem;
}

.break-alert-footer {
    margin-top: 20px;
}

.break-alert-close-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.break-alert-close-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
}

@keyframes fadeOut {
    to {
        opacity: 0;
    }
}

/* iOS specific fixes */
@supports (-webkit-touch-callout: none) {
    body {
        /* Fix for iOS viewport units */
        height: -webkit-fill-available;
    }
    
    .dashboard-container {
        /* Fix for Safari scrolling */
        min-height: -webkit-fill-available;
    }
}

/* Samsung Internet browser fixes */
@media (-android-) {
    input, textarea {
        /* Prevent zoom on focus */
        font-size: 16px !important;
    }
}

/* Prevent double-tap zoom on buttons */
button, a {
    touch-action: manipulation;
}

/* Hide scrollbar but keep functionality */
::-webkit-scrollbar {
    width: 0;
    background: transparent;
}
        /* Break Schedule Styling */
.break-schedule {
    background: rgba(0, 86, 179, 0.05);
    border-radius: 8px;
    padding: 10px;
    margin: 10px 0;
    border-left: 3px solid var(--primary);
}

.break-title {
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.break-item {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px dashed rgba(0, 86, 179, 0.1);
}

.break-item:last-child {
    border-bottom: none;
}

.break-time {
    color: var(--primary-dark);
    font-weight: 500;
}

.break-duration {
    color: var(--gray);
    font-size: 0.8rem;
}

/* Break Alert Styling */
.break-alert {
    position: fixed;
    bottom: 100px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1100;
    animation: slideInUp 0.3s ease forwards;
}

.break-alert-content {
    background: white;
    border-radius: 10px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
    padding: 15px;
    width: 300px;
    max-width: 90vw;
    border-left: 4px solid var(--warning);
}

.break-alert-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 10px;
}

.break-alert-header h4 {
    margin: 0;
    font-size: 1rem;
    color: var(--warning);
    flex: 1;
}

.break-alert-header i {
    color: var(--warning);
    margin-right: 10px;
}

.break-alert-close {
    background: none;
    border: none;
    color: var(--gray);
    font-size: 1.2rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.break-alert-close:hover {
    color: var(--dark);
    transform: scale(1.1);
}

.break-alert-body {
    color: var(--dark);
    font-size: 0.9rem;
    line-height: 1.4;
}

/* Break Status Indicators */
.break-status {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 15px;
    font-size: 0.7rem;
    font-weight: 500;
    margin-left: 5px;
}

.break-status.upcoming {
    background: rgba(255, 193, 7, 0.2);
    color: #856404;
}

.break-status.active {
    background: rgba(40, 167, 69, 0.2);
    color: #155724;
}

.break-status.completed {
    background: rgba(108, 117, 125, 0.2);
    color: var(--gray);
}

/* Break Countdown */
.break-countdown {
    font-size: 0.8rem;
    color: var(--primary);
    margin-top: 3px;
}

@keyframes slideInUp {
    from {
        transform: translateX(-50%) translateY(20px);
        opacity: 0;
    }
    to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }
}

@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(255, 193, 7, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(255, 193, 7, 0);
    }
}

/* Responsive adjustments for break display */
@media (max-width: 576px) {
    .break-alert {
        bottom: 80px;
    }
    
    .break-alert-content {
        width: 90%;
    }
    
    .break-schedule {
        padding: 8px;
    }
    
    .break-item {
        flex-direction: column;
        gap: 3px;
    }
}
        :root {
            --primary: #0056b3;
            --primary-dark: #003d82;
            --secondary: #ff6b00;
            --light: #f8f9fa;
            --dark: #343a40;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --gray: #6c757d;
            --white: #ffffff;
            --transition-speed: 0.4s;
            --transition-easing: cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* Fixed header - Updated with glass effect and half width */
        .fixed-header {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 50%;
            min-width: 300px;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 15px;
            color: var(--primary-dark);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all var(--transition-speed) var(--transition-easing);
            height: 50px;
            opacity: 0;
            visibility: hidden;
        }

        .fixed-header.visible {
            opacity: 1;
            visibility: visible;
        }

        .fixed-header h1 {
            font-size: 1.1rem;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .back-button {
            background: none;
            border: none;
            color: var(--primary-dark);
            font-size: 1.1rem;
            cursor: pointer;
            display: none;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            transform: translateX(-3px);
        }

        .header-user-info {
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }

        .header-user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--secondary);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            margin-right: 8px;
            background-size: cover;
            background-position: center;
            transition: all 0.3s ease;
            cursor: pointer;
            will-change: transform;
        }

        .header-user-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }

        .header-logout-btn {
            background: rgba(0, 86, 179, 0.1);
            border: none;
            color: var(--primary-dark);
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            padding: 5px 8px;
            border-radius: 15px;
        }

        .header-logout-btn:hover {
            background: rgba(0, 86, 179, 0.2);
        }

        .header-logout-btn i {
            margin-right: 5px;
            transition: all 0.3s ease;
        }

        .header-logout-btn:hover i {
            transform: translateX(-3px);
        }

        .floating-icon {
            position: absolute;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--primary);
            font-size: 1.2rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            z-index: 1;
            animation: float 6s ease-in-out infinite;
            cursor: pointer;
            transition: all 0.3s ease;
            will-change: transform;
        }

        .floating-icon:hover {
            transform: scale(1.1) translateY(-5px);
            background: rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .floating-icon:nth-child(1) {
            top: 10%;
            left: 10%;
            animation-delay: 0s;
        }

        .floating-icon:nth-child(2) {
            top: 20%;
            right: 15%;
            animation-delay: 1s;
        }

        .floating-icon:nth-child(3) {
            bottom: 15%;
            left: 12%;
            animation-delay: 2s;
        }

        .floating-icon:nth-child(4) {
            bottom: 25%;
            right: 10%;
            animation-delay: 3s;
        }

        /* Dashboard floating icons container */
        .dashboard-icons-container {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            z-index: 1000;
            pointer-events: none;
            transition: all var(--transition-speed) var(--transition-easing);
        }

        .dashboard-icons-container.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .dashboard-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--primary-dark);
            font-size: 1.4rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 100;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.18);
            margin: 0 10px;
            pointer-events: auto;
            transform: translateY(0);
            will-change: transform;
        }

        .dashboard-icon:hover {
            transform: scale(1.15) translateY(-5px);
            background: rgba(255, 255, 255, 0.35);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .dashboard-icon.active {
            background: var(--primary);
            color: white;
            transform: translateY(-10px);
        }

        .dashboard-icon-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: nowrap;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            pointer-events: none;
        }
        
        .dashboard-icon-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.7) transparent transparent transparent;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
            100% { transform: translateY(0) rotate(0deg); }
        }

        .login-container {
            position: relative;
            max-width: 450px;
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            z-index: 10;
            transition: all var(--transition-speed) var(--transition-easing);
            transform: translateY(0);
            opacity: 1;
            margin: 20px auto 0;
        }

        .login-container.hidden {
            transform: translateY(20px);
            opacity: 0;
            pointer-events: none;
        }

        .login-container:hover {
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            transform: translateY(-5px);
        }

        .login-header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 25px;
            text-align: center;
            position: relative;
        }

        .login-header h2 {
            font-weight: 600;
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .login-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .login-header::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 20px solid var(--primary);
        }

        .login-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.95rem;
        }

        .input-group {
            position: relative;
            display: flex;
            align-items: center;
        }

        .input-group .icon {
            position: absolute;
            left: 15px;
            color: var(--gray);
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px 12px 45px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            background-color: rgba(255, 255, 255, 0.8);
        }

        .form-control:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.2);
            outline: none;
            padding-left: 50px;
        }

        .form-control:focus + .icon {
            color: var(--primary);
            transform: scale(1.1);
        }

        .password-toggle {
            position: absolute;
            right: 15px;
            cursor: pointer;
            color: var(--gray);
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .password-toggle:hover {
            color: var(--primary);
            transform: scale(1.1);
        }

        .btn {
            display: inline-block;
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
            overflow: hidden;
            will-change: transform;
        }

        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(0, 86, 179, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(to right, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 86, 179, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .login-footer {
            text-align: center;
            padding: 20px;
            font-size: 0.9rem;
            color: var(--gray);
            border-top: 1px solid #eee;
        }

        .login-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
        }

        .login-footer a:hover {
            text-decoration: underline;
        }

        .login-footer a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        .login-footer a:hover::after {
            width: 100%;
        }

        /* Dashboard styles */
        .dashboard-container {
            display: none;
            max-width: 1200px;
            width: 100%;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            z-index: 10;
            margin: 20px auto;
            opacity: 0;
            transform: translateY(20px);
            transition: all var(--transition-speed) var(--transition-easing);
            min-height: calc(100vh - 140px);
        }

        .dashboard-container.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .dashboard-header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 50%;
            min-width: 300px;
            max-width: 500px;
            background: rgba(0, 86, 179, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            height: 50px;
        }

        .dashboard-header h2 {
            font-weight: 600;
            font-size: 1.1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-info {
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--secondary);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            margin-right: 10px;
            background-size: cover;
            background-position: center;
            transition: all 0.3s ease;
            cursor: pointer;
            will-change: transform;
        }

        .user-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }

        .logout-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            padding: 5px 10px;
            border-radius: 5px;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .logout-btn i {
            margin-right: 5px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover i {
            transform: translateX(-3px);
        }

        .dashboard-body {
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: calc(100% - 60px);
            margin-top: 70px; /* Added to account for fixed header */
        }

        .dashboard-section {
            margin-bottom: 30px;
            opacity: 0;
            transform: translateY(20px);
            transition: all var(--transition-speed) var(--transition-easing);
        }

        .dashboard-section.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .dashboard-section h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
            padding-bottom: 5px;
            transition: all 0.3s ease;
        }

        /* Announcements section in dashboard */
        .announcements-section {
            margin-bottom: 30px;
        }

        .announcement-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .announcement-item {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 15px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
            cursor: pointer;
            transform: translateY(0);
            opacity: 0;
        }

        .announcement-item.visible {
            opacity: 1;
        }

        .announcement-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .announcement-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .announcement-title {
            font-weight: 600;
            font-size: 1rem;
            color: var(--primary-dark);
        }

        .announcement-date {
            color: var(--gray);
            font-size: 0.8rem;
        }

        .announcement-content {
            max-height: 0;
            overflow: hidden;
            color: var(--dark);
            line-height: 1.6;
            transition: max-height 0.3s ease;
        }

        .announcement-item.expanded .announcement-content {
            max-height: 1000px;
            margin-top: 10px;
        }

        .announcement-image {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 10px 0;
            display: block;
            transition: all 0.3s ease;
        }

        .announcement-image:hover {
            transform: scale(1.02);
        }

        .announcement-author {
            font-size: 0.8rem;
            color: var(--gray);
            text-align: right;
            margin-top: 10px;
        }

        .no-announcements {
            text-align: center;
            padding: 20px;
            color: var(--gray);
        }

        /* Teams section in dashboard */
        .teams-section {
            margin-bottom: 30px;
        }

        .team-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            transform: translateY(0);
            opacity: 0;
        }

        .team-card.visible {
            opacity: 1;
        }

        .team-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .team-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary-dark);
        }

        .team-date {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .team-details {
            margin-bottom: 10px;
        }

        .team-detail {
            display: flex;
            margin-bottom: 5px;
        }

        .team-label {
            font-weight: 500;
            min-width: 100px;
            color: var(--dark);
        }

        .team-value {
            color: var(--gray);
        }

        .team-members {
            margin-top: 15px;
        }

        .team-members h4 {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .member-item {
            display: flex;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
            transition: all 0.3s ease;
        }

        .member-item:hover {
            background: rgba(0, 86, 179, 0.05);
            border-radius: 5px;
        }

        .member-role {
            font-weight: 500;
            min-width: 120px;
            color: var(--dark);
        }

        .member-name {
            color: var(--gray);
        }

        .supervisor-badge {
            background: var(--success);
            color: white;
            font-size: 0.7rem;
            padding: 2px 5px;
            border-radius: 3px;
            margin-left: 5px;
        }

        .no-teams {
            text-align: center;
            padding: 20px;
            color: var(--gray);
        }

        /* Fullscreen content sections */
        .fullscreen-content {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 80px;
            background: white;
            z-index: 900;
            overflow-y: auto;
            padding: 20px;
            transform: translateY(100%);
            transition: transform var(--transition-speed) var(--transition-easing);
            will-change: transform;
        }

        .fullscreen-content.active {
            display: block;
            transform: translateY(0);
        }

        .fullscreen-content h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 50%;
            min-width: 300px;
            max-width: 500px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 12px 20px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Teams content */
        .teams-content {
            background: var(--light);
        }

        /* Connect content */
        .connect-content {
            background: var(--light);
        }

        .connect-search-container {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            transition: all 0.3s ease;
            margin-top: 80px; /* Added to account for fixed header */
        }

        .connect-search-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .connect-search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.2);
            outline: none;
        }

        .connect-search-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .connect-search-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .connect-search-btn:active {
            transform: translateY(0);
        }

        .employee-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
        }

        .employee-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 15px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            transform: translateY(0);
            opacity: 0;
        }

        .employee-card.visible {
            opacity: 1;
        }

        .employee-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .employee-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ddd;
            background-size: cover;
            background-position: center;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-dark);
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .employee-avatar:hover {
            transform: scale(1.1);
        }

        .employee-info {
            flex: 1;
        }

        .employee-name {
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 5px;
        }

        .employee-id {
            color: var(--gray);
            font-size: 0.8rem;
            margin-bottom: 5px;
        }

        .employee-position {
            color: var(--dark);
            font-size: 0.9rem;
        }

        .employee-connect-btn {
            background: var(--success);
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
        }

        .employee-connect-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .employee-connect-btn:active {
            transform: translateY(0);
        }

        .employee-connect-btn i {
            margin-right: 5px;
        }

        .no-employees {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            grid-column: 1 / -1;
        }

        /* Chat forums content */
        .forums-content {
            background: var(--light);
        }

        .forum-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 4px solid var(--primary);
            transform: translateY(0);
            opacity: 0;
        }

        .forum-card.visible {
            opacity: 1;
        }

        .forum-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .forum-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .forum-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--primary-dark);
        }

        .forum-members {
            color: var(--gray);
            font-size: 0.8rem;
            display: flex;
            align-items: center;
        }

        .forum-members i {
            margin-right: 5px;
        }

        .forum-description {
            color: var(--dark);
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .forum-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--gray);
        }

        .forum-category {
            background: rgba(0, 86, 179, 0.1);
            color: var(--primary);
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
        }

        .forum-join-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .forum-join-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .forum-join-btn:active {
            transform: translateY(0);
        }

        .forum-exit-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .forum-exit-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .forum-exit-btn:active {
            transform: translateY(0);
        }

        /* Chat modal styles - Updated for fullscreen */
        .chat-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 1000;
            transition: all var(--transition-speed) var(--transition-easing);
            transform: translateX(100%);
        }

        .chat-modal.active {
            display: block;
            transform: translateX(0);
        }

        .chat-content {
            position: relative;
            width: 100%;
            height: 100%;
            background: white;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .chat-header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            position: relative;
            z-index: 10;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 50%;
            min-width: 300px;
            max-width: 500px;
            background: rgba(0, 86, 179, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            height: 50px;
        }

        .chat-back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            margin-right: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-back-btn:hover {
            transform: translateX(-3px);
        }

        .chat-header h3 {
            font-weight: 600;
            font-size: 1.1rem;
            margin: 0;
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin-top: 70px; /* Added to account for fixed header */
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .message {
            margin-bottom: 15px;
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 15px;
            position: relative;
            word-wrap: break-word;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            transform: scale(0.95);
            opacity: 0;
            animation: messageAppear 0.3s forwards;
        }

        @keyframes messageAppear {
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .message-sent {
            align-self: flex-end;
            background-color: var(--primary);
            color: white;
            border-bottom-right-radius: 0;
        }

        .message-received {
            align-self: flex-start;
            background-color: #f1f1f1;
            color: var(--dark);
            border-bottom-left-radius: 0;
        }

        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }

        .message-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
            background-color: #ddd;
            background-size: cover;
            background-position: center;
            transition: all 0.3s ease;
        }

        .message-avatar:hover {
            transform: scale(1.1);
        }

        .message-info {
            display: flex;
            flex-direction: column;
        }

        .message-sender {
            font-weight: bold;
            font-size: 0.8rem;
        }

        .message-time {
            opacity: 0.7;
            font-size: 0.7rem;
            margin-top: 2px;
        }

        .message-content {
            margin-top: 5px;
        }

        .message-actions {
            position: absolute;
            top: 5px;
            right: 5px;
            display: none;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2px 5px;
        }

        .message:hover .message-actions {
            display: flex;
        }

        .message-action {
            margin-left: 5px;
            cursor: pointer;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .message-action:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .message-sent .message-action {
            color: white;
        }

        .message-received .message-action {
            color: var(--dark);
        }

        .file-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .file-preview:hover {
            transform: scale(1.05);
        }

        .file-actions {
            display: flex;
            margin-top: 5px;
            gap: 5px;
        }

        .file-action {
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }

        .message-sent .file-action {
            color: white;
        }

        .message-received .file-action {
            color: var(--dark);
        }

        .file-action i {
            margin-right: 3px;
        }

        .file-message {
            margin-top: 10px;
            padding: 8px;
            background: rgba(0, 86, 179, 0.1);
            border-radius: 5px;
        }

        .file-message i {
            margin-right: 5px;
            color: var(--primary);
        }

        .audio-message {
            margin-top: 10px;
            padding: 8px;
            background: rgba(0, 86, 179, 0.1);
            border-radius: 5px;
            display: flex;
            align-items: center;
        }

        .audio-message i {
            margin-right: 5px;
            color: var(--primary);
        }

        .audio-player {
            flex-grow: 1;
            margin-left: 5px;
        }

        .chat-input-container {
            display: flex;
            padding: 10px;
            border-top: 1px solid #eee;
            transition: all 0.3s ease;
            background: white;
        }

        .chat-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 86, 179, 0.2);
        }

        .chat-send-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .chat-send-btn:hover {
            background: var(--primary-dark);
            transform: rotate(10deg) scale(1.1);
        }

        .file-upload-btn {
            background: var(--gray);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .file-upload-btn:hover {
            background: #5a6268;
            transform: rotate(10deg) scale(1.1);
        }

        .camera-upload-btn {
            background: var(--success);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .camera-upload-btn:hover {
            background: #218838;
            transform: rotate(10deg) scale(1.1);
        }

        .voice-record-btn {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
        }

        .voice-record-btn:hover {
            background: #c82333;
            transform: rotate(10deg) scale(1.1);
        }

        .voice-record-btn.recording {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }

        .file-upload-input {
            display: none;
        }

        .no-messages {
            text-align: center;
            color: var(--gray);
            padding: 20px;
        }

        /* Audio recording indicator */
        .recording-indicator {
            display: none;
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            z-index: 1001;
            align-items: center;
            animation: pulse 1.5s infinite;
        }

        .recording-indicator i {
            margin-right: 10px;
            color: var(--danger);
        }

        /* Change Password Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1100;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity var(--transition-speed) var(--transition-easing);
        }

        .modal.active {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            overflow: hidden;
            transform: translateY(-50px);
            transition: transform var(--transition-speed) var(--transition-easing);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 15px 20px;
            position: relative;
        }

        .modal-header h3 {
            font-weight: 600;
            font-size: 1.3rem;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .modal-close:hover {
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
        }

        .btn-secondary {
            background: var(--gray);
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }

        .alert-warning {
            background: rgba(255, 193, 7, 0.2);
            border-left: 4px solid var(--warning);
            color: #856404;
        }

        .alert-danger {
            background: rgba(220, 53, 69, 0.2);
            border-left: 4px solid var(--danger);
            color: #dc3545;
        }

        .alert i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        .logo {
            width: 80px;
            margin-bottom: 15px;
            filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.1));
            transition: all 0.3s ease;
        }

        .logo:hover {
            transform: rotate(-5deg) scale(1.05);
        }

        /* Profile Modal */
        .profile-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1100;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity var(--transition-speed) var(--transition-easing);
        }

        .profile-modal.active {
            display: flex;
            opacity: 1;
        }

        .profile-modal-content {
            background: white;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            overflow: hidden;
            transform: translateY(-50px);
            transition: transform var(--transition-speed) var(--transition-easing);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .profile-modal.active .profile-modal-content {
            transform: translateY(0);
        }

        .profile-modal-header {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            padding: 15px 20px;
            position: relative;
        }

        .profile-modal-header h3 {
            font-weight: 600;
            font-size: 1.3rem;
        }

        .profile-modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .profile-modal-close:hover {
            transform: rotate(90deg);
        }

        .profile-modal-body {
            padding: 20px;
            text-align: center;
        }

        .profile-avatar-container {
            position: relative;
            display: inline-block;
            margin-bottom: 20px;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: #ddd;
            background-size: cover;
            background-position: center;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-dark);
        }

        .profile-avatar:hover {
            opacity: 0.8;
            transform: scale(1.05);
        }

        .profile-avatar-edit {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--primary);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .profile-avatar-edit:hover {
            transform: scale(1.1);
        }

        .profile-avatar-input {
            display: none;
        }

        .profile-info {
            text-align: left;
            margin-top: 20px;
        }

        .profile-info-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
            transition: all 0.3s ease;
        }

        .profile-info-item:hover {
            background: rgba(0, 86, 179, 0.05);
            border-radius: 5px;
        }

        .profile-info-label {
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .profile-info-value {
            color: var(--gray);
        }

        /* Camera Modal */
        .camera-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            opacity: 0;
            transition: opacity var(--transition-speed) var(--transition-easing);
        }

        .camera-modal.active {
            display: flex;
            opacity: 1;
        }

        .camera-container {
            position: relative;
            width: 90%;
            max-width: 500px;
            background: black;
            border-radius: 10px;
            overflow: hidden;
            transform: scale(0.9);
            opacity: 0;
            transition: all var(--transition-speed) var(--transition-easing);
        }

        .camera-modal.active .camera-container {
            transform: scale(1);
            opacity: 1;
        }

        .camera-video {
            width: 100%;
            display: block;
        }

        .camera-controls {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            transform: translateY(20px);
            opacity: 0;
            transition: all var(--transition-speed) var(--transition-easing);
        }

        .camera-modal.active .camera-controls {
            transform: translateY(0);
            opacity: 1;
        }

        .camera-capture-btn {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .camera-capture-btn:hover {
            transform: scale(1.1);
        }

        .camera-close-btn {
            background: var(--gray);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .camera-close-btn:hover {
            transform: scale(1.1);
        }

        .camera-flip-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .camera-flip-btn:hover {
            transform: scale(1.1);
        }

        .camera-preview {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1002;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            opacity: 0;
            transition: opacity var(--transition-speed) var(--transition-easing);
        }

        .camera-preview.active {
            display: flex;
            opacity: 1;
        }

        .camera-preview-img {
            max-width: 90%;
            max-height: 80vh;
            transform: scale(0.9);
            opacity: 0;
            transition: all var(--transition-speed) var(--transition-easing);
        }

        .camera-preview.active .camera-preview-img {
            transform: scale(1);
            opacity: 1;
        }

        .camera-preview-controls {
            display: flex;
            margin-top: 20px;
            transform: translateY(20px);
            opacity: 0;
            transition: all var(--transition-speed) var(--transition-easing);
        }

        .camera-preview.active .camera-preview-controls {
            transform: translateY(0);
            opacity: 1;
        }

        .camera-preview-accept {
            background: var(--success);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .camera-preview-accept:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .camera-preview-retake {
            background: var(--danger);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
            transition: all 0.3s ease;
        }

        .camera-preview-retake:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        /* Loading animation */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 1;
            transition: opacity 0.5s ease;
        }

        .loading-container.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-animation {
            width: 80px;
            height: 80px;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 86, 179, 0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 86, 179, 0.5);
        }

        /* Responsive adjustments */
        @media (max-width: 576px) {
            .login-container {
                border-radius: 15px;
            }
            
            .login-header {
                padding: 20px;
            }
            
            .login-header h2 {
                font-size: 1.5rem;
            }
            
            .login-body {
                padding: 25px 20px;
            }
            
            .floating-icon {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }

            .dashboard-container {
                margin: 10px;
                border-radius: 15px;
            }

            .dashboard-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .user-info {
                margin-top: 10px;
            }

            .dashboard-icon {
                width: 50px;
                height: 50px;
                font-size: 1.2rem;
                margin: 0 5px;
            }

            .message {
                max-width: 90%;
            }

            .recording-indicator {
                bottom: 80px;
                font-size: 0.9rem;
                padding: 8px 15px;
            }

            .chat-input-container {
                flex-wrap: wrap;
            }

            .chat-input {
                margin-right: 0;
                margin-bottom: 10px;
                width: 100%;
            }

            .employee-list {
                grid-template-columns: 1fr;
            }

            .connect-search-container {
                flex-direction: column;
            }

            .connect-search-btn {
                padding: 10px;
            }
            
            /* Adjust fixed header for mobile */
            .fixed-header {
                width: 90%;
                min-width: unset;
                padding: 10px 15px;
                height: 45px;
            }
            
            .fixed-header h1 {
                font-size: 1rem;
            }
            
            .header-user-avatar {
                width: 28px;
                height: 28px;
                font-size: 0.8rem;
            }
            
            .header-logout-btn {
                font-size: 0.7rem;
                padding: 4px 6px;
            }

            /* Adjust dashboard header for mobile */
            .dashboard-header {
                width: 90%;
                min-width: unset;
                padding: 10px 15px;
                height: 45px;
            }
            
            .dashboard-header h2 {
                font-size: 1rem;
            }

            /* Adjust fullscreen content headers for mobile */
            .fullscreen-content h2 {
                width: 90%;
                min-width: unset;
                padding: 10px 15px;
                font-size: 1rem;
            }

            /* Adjust chat header for mobile */
            .chat-header {
                width: 90%;
                min-width: unset;
                padding: 10px 15px;
                height: 45px;
            }
            
            .chat-header h3 {
                font-size: 1rem;
            }
        }

        /* Animation for form elements */
        .form-group {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s forwards;
        }

        .form-group:nth-child(1) {
            animation-delay: 0.1s;
        }

        .form-group:nth-child(2) {
            animation-delay: 0.2s;
        }

        .form-group:nth-child(3) {
            animation-delay: 0.3s;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Ripple effect for button */
        .ripple {
            position: relative;
            overflow: hidden;
        }

        .ripple-effect {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple {
            to {
                transform: scale(2.5);
                opacity: 0;
            }
        }

        /* Tooltip styles */
        .tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: nowrap;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
            margin-bottom: 10px;
            pointer-events: none;
        }
        
        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0, 0, 0, 0.7) transparent transparent transparent;
        }

        /* Swipe animation for fullscreen content */
        @keyframes swipeIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }

        @keyframes swipeOut {
            from { transform: translateX(0); }
            to { transform: translateX(100%); }
        }

        /* Parallax effect for dashboard sections */
        .parallax-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            z-index: -1;
            transform: translateZ(-1px) scale(1.1);
        }

        /* Lottie animation container */
        .lottie-container {
            width: 100%;
            height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Smooth scroll for profile modal */
        .profile-modal-body {
            max-height: 70vh;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        /* Micro-interaction for buttons */
        .btn-micro {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .btn-micro:active {
            transform: scale(0.95);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Hover effect for cards */
        .hover-grow {
            transition: transform 0.3s ease;
        }

        .hover-grow:hover {
            transform: scale(1.02);
        }

        /* Fade transition for elements */
        .fade-transition {
            transition: opacity 0.3s ease;
        }

        /* Slide up animation */
        .slide-up {
            animation: slideUp 0.5s ease forwards;
        }

        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* Bounce animation */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .bounce {
            animation: bounce 1s infinite;
        }
        /* Add space between chat forums header and content */
.forums-content {
    padding-top: 80px; /* Creates space below the fixed header */
}

/* Adjust the search container position to account for the new padding */
.connect-search-container {
    margin-top: 30px; /* Reduces the existing top margin to compensate */
}

/* Ensure the employee list has proper spacing */
.employee-list {
    margin-top: 20px;
}

/* Adjust the forums body spacing */
#forumsBody {
    margin-top: 20px;
}

/* For mobile responsiveness */
@media (max-width: 576px) {
    .forums-content {
        padding-top: 60px; /* Slightly less space on mobile */
    }
    
    .connect-search-container {
        margin-top: 20px;
    }
}
    </style>
</head>
<body>
    <!-- Fixed Header -->
    <header class="fixed-header">
        <button class="back-button" id="globalBackButton">
            <i class="fas fa-arrow-left"></i>
        </button>
        <h1 id="headerTitle">DNATA Employee Portal</h1>
        <div class="header-actions" id="headerActions">
            <div class="header-user-info">
                <div class="header-user-avatar" id="headerUserAvatar">JD</div>
                <button class="header-logout-btn" id="headerLogoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout</br>
                </button>
            </div>
        </div>
    </header>

    <!-- Loading animation -->
    <div class="loading-container" id="loadingContainer">
        <div class="loading-animation" id="loadingAnimation"></div>
    </div>

    <!-- Floating interactive icons -->
    <div class="floating-icon" data-tooltip="DNATA Help Center">
        <i class="fas fa-question"></i>
    </div>
    <div class="floating-icon" data-tooltip="Employee Support">
        <i class="fas fa-headset"></i>
    </div>
    <div class="floating-icon" data-tooltip="Quick Links">
        <i class="fas fa-link"></i>
    </div>
    <div class="floating-icon" data-tooltip="Contact HR">
        <i class="fas fa-user-tie"></i>
    </div>

    <!-- Audio recording indicator -->
    <div class="recording-indicator" id="recordingIndicator">
        <i class="fas fa-microphone"></i>
        <span>Recording... Tap to stop</span>
    </div>

    <!-- Login Container -->
    <div class="login-container" id="loginContainer">
        <div class="login-header">
            <img src="https://via.placeholder.com/80x40?text=DNATA" alt="DNATA Logo" class="logo">
            <h2>Employee Portal</h2>
            <p>Secure access to your workplace</p>
        </div>
        
        <div class="login-body">
            <div id="temporaryPasswordAlert" class="alert alert-warning" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i>
                <div>You are using a temporary password. Please change it immediately for security reasons.</div>
            </div>
            
            <div id="disabledAccountAlert" class="alert alert-danger" style="display: none;">
                <i class="fas fa-ban"></i>
                <div>Your account has been disabled. Please contact HR for assistance.</div>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">Employee ID</label>
                    <div class="input-group">
                        <i class="fas fa-user icon"></i>
                        <input type="text" id="username" class="form-control" placeholder="Enter your employee ID" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="password">Password</label>
                    <div class="input-group">
                        <i class="fas fa-lock icon"></i>
                        <input type="password" id="password" class="form-control" placeholder="Enter your password" required>
                        <i class="fas fa-eye password-toggle" id="togglePassword"></i>
                    </div>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary ripple" id="loginBtn">
                        <span id="btnText">Sign In</span>
                        <i class="fas fa-spinner fa-spin" id="btnSpinner" style="display: none;"></i>
                    </button>
                </div>
            </form>
        </div>
        
        <div class="login-footer">
            <a href="#" id="forgotPassword">Forgot Password?</a> | <a href="#">Need Help?</a>
        </div>
    </div>

    <!-- Dashboard Container -->
    <div class="dashboard-container" id="dashboardContainer">
        <div class="dashboard-header">
            <h2>Employee Dashboard</h2>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">JD</div>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </div>
        
        <div class="dashboard-body">
            <!-- Announcements Section -->
            <div class="dashboard-section announcements-section">
                <h3>Company Announcements</h3>
                <div class="announcement-list" id="announcementsBody">
                    <div class="no-announcements">Loading announcements...</div>
                </div>
            </div>
            
            <!-- Teams Section -->
            <div class="dashboard-section teams-section">
                <h3>My Upcoming Teams</h3>
                <div id="teamsList">
                    <div class="no-teams">Loading your team assignments...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Fullscreen content sections -->
    <div class="fullscreen-content teams-content" id="teamsContent">
        <h2>My Team Assignments</h2>
        <div id="teamsModalBody">
            <div class="no-teams">Loading your team assignments...</div>
        </div>
    </div>

    <div class="fullscreen-content connect-content" id="connectContent">
        <h2>Employee Connect</h2>
        <div class="connect-search-container">
            <input type="text" id="employeeSearchInput" class="connect-search-input" placeholder="Search employees by ID or name">
            <button class="connect-search-btn" id="employeeSearchBtn">
                <i class="fas fa-search"></i> Search
            </button>
        </div>
        <div class="employee-list" id="employeeList">
            <div class="no-employees">Search for employees to connect with</div>
        </div>
    </div>

    <div class="fullscreen-content forums-content" id="forumsContent">
        <h2>Employee Chat Forums</h2>
        <div id="forumsBody">
            <div class="no-teams">Loading chat forums...</div>
        </div>
    </div>
 </br>
    </br>
    <!-- Dashboard Floating Icons -->
    <div class="dashboard-icons-container hidden" id="dashboardIconsContainer">
        <div class="dashboard-icon" id="dashboardHomeIcon">
            <i class="fas fa-home"></i>
            <div class="dashboard-icon-tooltip">Home</div>
        </div>
        
        <div class="dashboard-icon" id="dashboardTeamsIcon">
            <i class="fas fa-users"></i>
            <div class="dashboard-icon-tooltip">My Teams</div>
        </div>
        
        <div class="dashboard-icon" id="dashboardConnectIcon">
            <i class="fas fa-comments"></i>
            <div class="dashboard-icon-tooltip">Connect</div>
        </div>
        
        <div class="dashboard-icon" id="dashboardForumsIcon">
            <i class="fas fa-comment-dots"></i>
            <div class="dashboard-icon-tooltip">Chat Forums</div>
        </div>
    </div>

    <!-- Chat Modal - Updated for fullscreen -->
    <div class="chat-modal" id="chatModal">
        <div class="chat-content">
            <div class="chat-header">
                <button class="chat-back-btn" id="chatBackBtn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h3 id="chatForumTitle">Chat Forum</h3>
            </div>
            <div class="chat-body">
                <div class="chat-messages" id="chatMessages">
                    <div class="no-messages">Loading messages...</div>
                </div>
                <div class="chat-input-container">
                    <button class="voice-record-btn" id="voiceRecordBtn" title="Record Voice Message">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <button class="camera-upload-btn" id="cameraUploadBtn" title="Take Photo">
                        <i class="fas fa-camera"></i>
                    </button>
                    <button class="file-upload-btn" id="fileUploadBtn" title="Attach File">
                        <i class="fas fa-paperclip"></i>
                        <input type="file" id="fileUploadInput" class="file-upload-input" accept="image/*, .pdf, .doc, .docx, .xls, .xlsx">
                    </button>
                    <input type="text" class="chat-input" id="chatInput" placeholder="Type your message here...">
                    <button class="chat-send-btn" id="chatSendBtn" title="Send Message">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal" id="changePasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Change Password</h3>
                <span class="modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <p>For security reasons, please change your temporary password.</p>
                <form id="changePasswordForm">
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <input type="password" id="currentPassword" class="form-control" placeholder="Enter current password" required>
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" class="form-control" placeholder="Enter new password" required>
                        <small class="text-muted">Password must be at least 8 characters long</small>
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">Confirm New Password</label>
                        <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm new password" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close">Cancel</button>
                <button class="btn btn-primary" id="submitNewPassword">Update Password</button>
            </div>
        </div>
    </div>

    <!-- Profile Modal -->
    <div class="profile-modal" id="profileModal">
        <div class="profile-modal-content">
            <div class="profile-modal-header">
                <h3>My Profile</h3>
                <span class="profile-modal-close">&times;</span>
            </div>
            <div class="profile-modal-body">
                <div class="profile-avatar-container">
                    <div class="profile-avatar" id="profileAvatar"></div>
                    <div class="profile-avatar-edit" id="profileAvatarEdit">
                        <i class="fas fa-camera"></i>
                        <input type="file" id="profileAvatarInput" class="profile-avatar-input" accept="image/*">
                    </div>
                </div>
                <div class="profile-info">
                    <div class="profile-info-item">
                        <div class="profile-info-label">Employee ID</div>
                        <div class="profile-info-value" id="profileEmployeeId"></div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Name</div>
                        <div class="profile-info-value" id="profileName"></div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Department</div>
                        <div class="profile-info-value" id="profileDepartment"></div>
                    </div>
                    <div class="profile-info-item">
                        <div class="profile-info-label">Position</div>
                        <div class="profile-info-value" id="profilePosition"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Camera Modal -->
    <div class="camera-modal" id="cameraModal">
        <div class="camera-container">
            <video class="camera-video" id="cameraVideo" autoplay playsinline></video>
        </div>
        <div class="camera-controls">
            <button class="camera-close-btn" id="cameraCloseBtn">
                <i class="fas fa-times"></i>
            </button>
            <button class="camera-capture-btn" id="cameraCaptureBtn">
                <i class="fas fa-camera"></i>
            </button>
            <button class="camera-flip-btn" id="cameraFlipBtn">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
    </div>

    <!-- Camera Preview Modal -->
    <div class="camera-preview" id="cameraPreview">
        <img class="camera-preview-img" id="cameraPreviewImg">
        <div class="camera-preview-controls">
            <button class="camera-preview-retake" id="cameraPreviewRetake">
                <i class="fas fa-redo"></i> Retake
            </button>
            <button class="camera-preview-accept" id="cameraPreviewAccept">
                <i class="fas fa-check"></i> Use Photo
            </button>
        </div>
    </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyDQfo8qILskxClJy52_19tFdx6xMsiQD2M",
        authDomain: "dnata-e2569.firebaseapp.com",
        databaseURL: "https://dnata-e2569-default-rtdb.firebaseio.com",
        projectId: "dnata-e2569",
        storageBucket: "dnata-e2569.appspot.com",
        messagingSenderId: "693382423789",
        appId: "1:693382423789:web:8aa14672c6ef34ee59d8e4",
        measurementId: "G-B6F7CHPM2Y"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Initialize loading animation
    const loadingAnimation = document.getElementById('loadingAnimation');
    const loadingContainer = document.getElementById('loadingContainer');
    
    // Load Lottie animation
    const anim = lottie.loadAnimation({
        container: loadingAnimation,
        renderer: 'svg',
        loop: true,
        autoplay: true,
        path: 'https://assets9.lottiefiles.com/packages/lf20_usmfx6bp.json' // Replace with your Lottie JSON
    });

    // Hide loading animation after 1.5 seconds (simulate loading)
    setTimeout(() => {
        loadingContainer.classList.add('hidden');
    }, 1500);

    // Global variables for break management
    let breakCheckInterval = null;
    let alertedBreaks = new Set();
    let teams = []; // Initialize teams array globally

    document.addEventListener('DOMContentLoaded', function() {
        // Fixed header elements
        const fixedHeader = document.querySelector('.fixed-header');
        const headerTitle = document.getElementById('headerTitle');
        const headerActions = document.getElementById('headerActions');
        const headerUserAvatar = document.getElementById('headerUserAvatar');
        const headerLogoutBtn = document.getElementById('headerLogoutBtn');
        const globalBackButton = document.getElementById('globalBackButton');

        // Password toggle functionality
        const togglePassword = document.getElementById('togglePassword');
        const password = document.getElementById('password');
        
        togglePassword.addEventListener('click', function() {
            const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
            password.setAttribute('type', type);
            this.classList.toggle('fa-eye');
            this.classList.toggle('fa-eye-slash');
            
            // Micro-interaction
            this.style.transform = 'scale(1.2)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 200);
        });

        // Ripple effect for buttons
        const buttons = document.querySelectorAll('.ripple');
        buttons.forEach(button => {
            button.addEventListener('click', function(e) {
                const x = e.clientX - e.target.getBoundingClientRect().left;
                const y = e.clientY - e.target.getBoundingClientRect().top;
                
                const ripple = document.createElement('span');
                ripple.classList.add('ripple-effect');
                ripple.style.left = `${x}px`;
                ripple.style.top = `${y}px`;
                
                this.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
        });

        // Modal functionality
        const modal = document.getElementById('changePasswordModal');
        const modalCloseButtons = document.querySelectorAll('.modal-close');
        
        modalCloseButtons.forEach(button => {
            button.addEventListener('click', function() {
                modal.classList.remove('active');
            });
        });

        // Profile modal functionality
        const profileModal = document.getElementById('profileModal');
        const profileModalClose = document.querySelector('.profile-modal-close');
        
        profileModalClose.addEventListener('click', function() {
            profileModal.classList.remove('active');
        });

        // Fullscreen content sections
        const fullscreenContents = document.querySelectorAll('.fullscreen-content');
        let currentActiveContent = null;
        let currentActiveIcon = null;

        function showFullscreenContent(contentId) {
            // Hide currently active content with animation
            if (currentActiveContent) {
                currentActiveContent.classList.remove('active');
                if (currentActiveIcon) {
                    currentActiveIcon.classList.remove('active');
                }
            }
            
            // Show new content with animation
            const content = document.getElementById(contentId);
            content.classList.add('active');
            currentActiveContent = content;
            
            // Highlight the active icon
            const iconId = contentId.replace('Content', 'Icon');
            currentActiveIcon = document.getElementById(iconId);
            if (currentActiveIcon) {
                currentActiveIcon.classList.add('active');
            }
            
            // Update header title
            const contentTitle = content.querySelector('h2').textContent;
            headerTitle.textContent = contentTitle;
            
            // Show back button in header
            globalBackButton.style.display = 'block';
            
            // Load data if needed
            if (contentId === 'teamsContent') {
                const user = auth.currentUser;
                if (user) {
                    const username = user.email.split('@')[0];
                    loadEmployeeTeamsForModal(username);
                }
            } else if (contentId === 'connectContent') {
                // Initialize the connect page with all employees
                searchEmployees();
            } else if (contentId === 'forumsContent') {
                loadChatForums();
            }
            
            // Animate in the content
            const elements = content.querySelectorAll('.employee-card, .forum-card, .team-card');
            elements.forEach((el, index) => {
                setTimeout(() => {
                    el.classList.add('visible');
                }, index * 100);
            });
        }

        function hideFullscreenContent() {
            if (currentActiveContent) {
                currentActiveContent.classList.remove('active');
                currentActiveContent = null;
                
                if (currentActiveIcon) {
                    currentActiveIcon.classList.remove('active');
                    currentActiveIcon = null;
                }
            }
            
            // Reset header title
            headerTitle.textContent = 'DNATA Employee Portal';
            
            // Hide back button in header
            globalBackButton.style.display = 'none';
            
            // Show dashboard sections with animation
            const sections = document.querySelectorAll('.dashboard-section');
            sections.forEach((section, index) => {
                setTimeout(() => {
                    section.classList.add('visible');
                }, index * 150);
            });
        }

        // Global back button functionality
        globalBackButton.addEventListener('click', function() {
            if (currentActiveContent) {
                // Animate out the current content
                currentActiveContent.style.animation = 'swipeOut 0.4s forwards';
                setTimeout(() => {
                    hideFullscreenContent();
                    currentActiveContent.style.animation = '';
                }, 400);
            }
        });

        // Dashboard icon click handlers
        document.getElementById('dashboardHomeIcon').addEventListener('click', function() {
            if (currentActiveContent) {
                // Animate out the current content
                currentActiveContent.style.animation = 'swipeOut 0.4s forwards';
                setTimeout(() => {
                    hideFullscreenContent();
                    currentActiveContent.style.animation = '';
                }, 400);
            }
        });
        
        document.getElementById('dashboardTeamsIcon').addEventListener('click', function() {
            if (currentActiveContent && currentActiveContent.id === 'teamsContent') {
                currentActiveContent.style.animation = 'swipeOut 0.4s forwards';
                setTimeout(() => {
                    hideFullscreenContent();
                    currentActiveContent.style.animation = '';
                }, 400);
            } else {
                showFullscreenContent('teamsContent');
                document.getElementById('teamsContent').style.animation = 'swipeIn 0.4s forwards';
            }
        });
        
        document.getElementById('dashboardConnectIcon').addEventListener('click', function() {
            if (currentActiveContent && currentActiveContent.id === 'connectContent') {
                currentActiveContent.style.animation = 'swipeOut 0.4s forwards';
                setTimeout(() => {
                    hideFullscreenContent();
                    currentActiveContent.style.animation = '';
                }, 400);
            } else {
                showFullscreenContent('connectContent');
                document.getElementById('connectContent').style.animation = 'swipeIn 0.4s forwards';
            }
        });
        
        document.getElementById('dashboardForumsIcon').addEventListener('click', function() {
            if (currentActiveContent && currentActiveContent.id === 'forumsContent') {
                currentActiveContent.style.animation = 'swipeOut 0.4s forwards';
                setTimeout(() => {
                    hideFullscreenContent();
                    currentActiveContent.style.animation = '';
                }, 400);
            } else {
                showFullscreenContent('forumsContent');
                document.getElementById('forumsContent').style.animation = 'swipeIn 0.4s forwards';
            }
        });

        // Employee search functionality
        const employeeSearchInput = document.getElementById('employeeSearchInput');
        const employeeSearchBtn = document.getElementById('employeeSearchBtn');
        const employeeList = document.getElementById('employeeList');
        
        employeeSearchBtn.addEventListener('click', searchEmployees);
        employeeSearchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchEmployees();
            }
        });

        function searchEmployees() {
            const searchTerm = employeeSearchInput.value.trim().toLowerCase();
            employeeList.innerHTML = '<div class="no-employees">Searching employees...</div>';
            
            // Add micro-interaction to search button
            employeeSearchBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                employeeSearchBtn.style.transform = 'scale(1)';
            }, 200);
            
            db.collection('employees').get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        employeeList.innerHTML = '<div class="no-employees">No employees found</div>';
                        return;
                    }
                    
                    let employees = [];
                    
                    snapshot.forEach(doc => {
                        const employee = doc.data();
                        employee.id = doc.id;
                        
                        // Check if employee matches search term
                        if (!searchTerm || 
                            employee.id.toLowerCase().includes(searchTerm) ||
                            (employee.firstName && employee.firstName.toLowerCase().includes(searchTerm)) ||
                            (employee.lastName && employee.lastName.toLowerCase().includes(searchTerm))) {
                            employees.push(employee);
                        }
                    });
                    
                    if (employees.length === 0) {
                        employeeList.innerHTML = '<div class="no-employees">No employees match your search</div>';
                    } else {
                        displayEmployees(employees);
                    }
                })
                .catch(error => {
                    console.error('Error searching employees:', error);
                    employeeList.innerHTML = '<div class="no-employees">Error searching employees. Please try again.</div>';
                });
        }

        function displayEmployees(employees) {
            employeeList.innerHTML = '';
            
            employees.forEach((employee, index) => {
                const employeeCard = document.createElement('div');
                employeeCard.className = 'employee-card';
                
                const initials = `${employee.firstName?.charAt(0) || ''}${employee.lastName?.charAt(0) || ''}`;
                const avatarUrl = employee.avatarUrl || '';
                
                employeeCard.innerHTML = `
                    <div class="employee-avatar" style="${avatarUrl ? `background-image: url('${avatarUrl}')` : ''}">
                        ${avatarUrl ? '' : initials}
                    </div>
                    <div class="employee-info">
                        <div class="employee-name">${employee.firstName || ''} ${employee.lastName || ''}</div>
                        <div class="employee-id">${employee.id}</div>
                        <div class="employee-position">${employee.position || 'Employee'}</div>
                    </div>
                    <button class="employee-connect-btn" data-employee-id="${employee.id}">
                        <i class="fas fa-paper-plane"></i> Message
                    </button>
                `;
                
                employeeList.appendChild(employeeCard);
                
                // Animate each card with a delay
                setTimeout(() => {
                    employeeCard.classList.add('visible');
                }, index * 100);
            });
            
            // Add event listeners to connect buttons
            document.querySelectorAll('.employee-connect-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const employeeId = this.getAttribute('data-employee-id');
                    startPrivateChat(employeeId);
                    
                    // Micro-interaction
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 200);
                });
            });
        }

        function startPrivateChat(employeeId) {
            const user = auth.currentUser;
            if (!user) return;
            
            const currentUserId = user.email.split('@')[0];
            
            // Check if a private chat already exists between these users
            const chatId = [currentUserId, employeeId].sort().join('_');
            
            db.collection('privateChats').doc(chatId).get()
                .then(doc => {
                    if (!doc.exists) {
                        // Create a new private chat
                        return db.collection('privateChats').doc(chatId).set({
                            participants: [currentUserId, employeeId],
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                })
                .then(() => {
                    // Open the chat
                    openPrivateChat(chatId, employeeId);
                })
                .catch(error => {
                    console.error('Error starting private chat:', error);
                    alert('Error starting private chat. Please try again.');
                });
        }

        function openPrivateChat(chatId, employeeId) {
            currentForumId = chatId;
            
            // Get the employee's name for the chat title
            db.collection('employees').doc(employeeId).get()
                .then(doc => {
                    if (doc.exists) {
                        const employee = doc.data();
                        chatForumTitle.textContent = `${employee.firstName || ''} ${employee.lastName || ''}`;
                        chatModal.classList.add('active');
                        chatMessages.innerHTML = '<div class="no-messages">Loading messages...</div>';
                        
                        // Load messages for this private chat
                        loadPrivateMessages(chatId);
                    }
                });
        }

        function loadPrivateMessages(chatId) {
            if (unsubscribeMessages) {
                unsubscribeMessages();
            }

            const messagesQuery = db.collection('privateChats').doc(chatId)
                .collection('messages')
                .orderBy('timestamp', 'asc')
                .limit(100);

            unsubscribeMessages = messagesQuery.onSnapshot(snapshot => {
                if (snapshot.empty) {
                    chatMessages.innerHTML = '<div class="no-messages">No messages yet. Start the conversation!</div>';
                    return;
                }

                chatMessages.innerHTML = '';
                const user = auth.currentUser;
                const currentUser = user ? user.email.split('@')[0] : null;

                snapshot.forEach(doc => {
                    const message = doc.data();
                    const messageElement = createMessageElement(message, currentUser, doc.id);
                    chatMessages.appendChild(messageElement);
                });

                // Scroll to bottom with smooth behavior
                setTimeout(() => {
                    chatMessages.scrollTo({
                        top: chatMessages.scrollHeight,
                        behavior: 'smooth'
                    });
                }, 100);
            }, error => {
                console.error('Error loading private messages:', error);
                chatMessages.innerHTML = '<div class="no-messages">Error loading messages. Please try again.</div>';
            });
        }

        // Load announcements for dashboard
        function loadAnnouncements() {
            const announcementsBody = document.getElementById('announcementsBody');
            announcementsBody.innerHTML = '<div class="no-announcements">Loading announcements...</div>';
            
            db.collection('announcements')
                .orderBy('date', 'desc')
                .limit(5) // Show only 5 most recent announcements on dashboard
                .get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        announcementsBody.innerHTML = '<div class="no-announcements">No announcements found.</div>';
                        return;
                    }
                    
                    announcementsBody.innerHTML = '';
                    
                    snapshot.forEach((doc, index) => {
                        const announcement = doc.data();
                        const date = announcement.date.toDate();
                        const formattedDate = date.toLocaleDateString('en-US', {
                            year: 'numeric',
                            month: 'long',
                            day: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        const announcementItem = document.createElement('div');
                        announcementItem.className = 'announcement-item';
                        
                        let announcementContent = `
                            <div class="announcement-header">
                                <div class="announcement-title">${announcement.title}</div>
                                <div class="announcement-date">${formattedDate}</div>
                            </div>
                            <div class="announcement-content" style="display: none;">
                                ${announcement.content}
                        `;
                        
                        // Add image if available
                        if (announcement.imageUrl) {
                            announcementContent += `
                                <img src="${announcement.imageUrl}" alt="Announcement Image" class="announcement-image">
                            `;
                        }
                        
                        announcementContent += `
                                <div class="announcement-author">Posted by: ${announcement.author || 'Management'}</div>
                            </div>
                        `;
                        
                        announcementItem.innerHTML = announcementContent;
                        announcementsBody.appendChild(announcementItem);
                        
                        // Add click event to toggle content
                        announcementItem.addEventListener('click', function() {
                            this.classList.toggle('expanded');
                            const content = this.querySelector('.announcement-content');
                            if (this.classList.contains('expanded')) {
                                content.style.display = 'block';
                            } else {
                                content.style.display = 'none';
                            }
                        });
                        
                        // Animate each item with a delay
                        setTimeout(() => {
                            announcementItem.classList.add('visible');
                        }, index * 150);
                    });
                })
                .catch(error => {
                    console.error('Error loading announcements:', error);
                    announcementsBody.innerHTML = '<div class="no-announcements">Error loading announcements. Please try again later.</div>';
                });
        }

        // Load employee's teams for dashboard
        function loadEmployeeTeams(employeeId) {
            const teamsList = document.getElementById('teamsList');
            teamsList.innerHTML = '<div class="no-teams">Loading your team assignments...</div>';
            
            // Get current date
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            // Query teams where this employee is a member
            db.collection('teams')
                .where('date', '>=', today.toISOString().split('T')[0])
                .orderBy('date')
                .get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        teamsList.innerHTML = '<div class="no-teams">You have no upcoming team assignments.</div>';
                        return;
                    }
                    
                    teams = []; // Reset teams array
                    
                    snapshot.forEach(doc => {
                        const team = doc.data();
                        team.id = doc.id;
                        
                        // Check if employee is in this team
                        if (isEmployeeInTeam(employeeId, team)) {
                            teams.push(team);
                        }
                    });
                    
                    if (teams.length === 0) {
                        teamsList.innerHTML = '<div class="no-teams">You have no upcoming team assignments.</div>';
                    } else {
                        displayTeams(teams, teamsList);
                    }
                    
                    // Start checking for break times
                    startBreakCheck();
                })
                .catch(error => {
                    console.error('Error loading teams:', error);
                    teamsList.innerHTML = '<div class="no-teams">Error loading your team assignments. Please try again later.</div>';
                });
        }

        // Load employee's teams for modal
        function loadEmployeeTeamsForModal(employeeId) {
            const teamsModalBody = document.getElementById('teamsModalBody');
            teamsModalBody.innerHTML = '<div class="no-teams">Loading your team assignments...</div>';
            
            // Get all teams (past and future)
            db.collection('teams')
                .orderBy('date')
                .get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        teamsModalBody.innerHTML = '<div class="no-teams">You have no team assignments.</div>';
                        return;
                    }
                    
                    let modalTeams = [];
                    
                    snapshot.forEach(doc => {
                        const team = doc.data();
                        team.id = doc.id;
                        
                        // Check if employee is in this team
                        if (isEmployeeInTeam(employeeId, team)) {
                            modalTeams.push(team);
                        }
                    });
                    
                    if (modalTeams.length === 0) {
                        teamsModalBody.innerHTML = '<div class="no-teams">You have no team assignments.</div>';
                    } else {
                        displayTeams(modalTeams, teamsModalBody);
                    }
                })
                .catch(error => {
                    console.error('Error loading teams:', error);
                    teamsModalBody.innerHTML = '<div class="no-teams">Error loading your team assignments. Please try again later.</div>';
                });
        }

        // Check if employee is in a team
        function isEmployeeInTeam(employeeId, team) {
            // Check supervisor
            if (team.supervisor && team.supervisor.id === employeeId) {
                return true;
            }
            
            // Check staff (handles both single staff and array)
            if (team.staff) {
                if (Array.isArray(team.staff)) {
                    if (team.staff.some(staff => staff.id === employeeId)) {
                        return true;
                    }
                } else if (team.staff.id === employeeId) {
                    return true;
                }
            }
            
            // Check porters
            if (team.porters && team.porters.some(porter => porter.id === employeeId)) {
                return true;
            }
            
            // Check forklift operators (handles both single and array)
            if (team.forkliftOperator && team.forkliftOperator.id === employeeId) {
                return true;
            }
            
            if (team.forkliftOperators && team.forkliftOperators.some(forklift => forklift.id === employeeId)) {
                return true;
            }
            
            return false;
        }

        // Display teams in the specified container
        function displayTeams(teamsToDisplay, container) {
            container.innerHTML = '';
            
            teamsToDisplay.forEach((team, index) => {
                const teamCard = document.createElement('div');
                teamCard.className = 'team-card';
                
                // Format date
                const date = new Date(team.date);
                const formattedDate = date.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                // Format shift
                const shift = team.shift === 'morning' ? 'Morning (6:00 AM - 6:00 PM)' : 'Night (6:00 PM - 6:00 AM)';
                
                // Determine if this is a past team
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const isPastTeam = date < today;
                
                // Format breaks information
                let breaksHTML = '';
                if (team.breaks && (team.breaks.teamBreaks || team.breaks.individualBreaks)) {
                    const teamBreaks = team.breaks.teamBreaks || [];
                    const individualBreaks = team.breaks.individualBreaks || [];
                    
                    if (teamBreaks.length > 0 || individualBreaks.length > 0) {
                        breaksHTML = `
                            <div class="break-schedule">
                                <div class="break-title">
                                    <i class="fas fa-clock"></i> Break Schedule
                                </div>
                                ${teamBreaks.slice(0, 2).map(breakItem => `
                                    <div class="break-item">
                                        <div class="break-time">Team: ${formatTime(breakItem.start)} - ${formatTime(breakItem.end)}</div>
                                        <div class="break-duration">${calculateDuration(breakItem.start, breakItem.end)}</div>
                                    </div>
                                `).join('')}
                                ${individualBreaks.length > 0 ? `
                                    <div class="break-item">
                                        <div class="break-time">${individualBreaks.length} individual breaks</div>
                                    </div>
                                ` : ''}
                                ${teamBreaks.length > 2 ? `
                                    <div class="break-item">
                                        <div class="break-time">+${teamBreaks.length - 2} more team breaks</div>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }
                }
                
                teamCard.innerHTML = `
                    <div class="team-header">
                        <div class="team-name">${team.name} ${isPastTeam ? '<span style="color: var(--gray); font-size: 0.8rem;">(Completed)</span>' : ''}</div>
                        <div class="team-date">${formattedDate}</div>
                    </div>
                    <div class="team-details">
                        <div class="team-detail">
                            <div class="team-label">Shift:</div>
                            <div class="team-value">${shift}</div>
                        </div>
                        <div class="team-detail">
                            <div class="team-label">Location:</div>
                            <div class="team-value">${team.location || 'Not specified'}</div>
                        </div>
                        <div class="team-detail">
                            <div class="team-label">Area:</div>
                            <div class="team-value">${team.area || 'Not specified'}</div>
                        </div>
                    </div>
                    ${breaksHTML}
                    <div class="team-members">
                        <h4>Team Members</h4>
                        ${team.supervisor ? `
                            <div class="member-item">
                                <div class="member-role">Supervisor:</div>
                                <div class="member-name">${team.supervisor.name} <span class="supervisor-badge">Team Leader</span></div>
                            </div>
                        ` : ''}
                        ${team.staff ? 
                            (Array.isArray(team.staff) ? 
                                team.staff.map(staff => `
                                    <div class="member-item">
                                        <div class="member-role">Staff:</div>
                                        <div class="member-name">${staff.name}</div>
                                    </div>
                                `).join('') : `
                                <div class="member-item">
                                    <div class="member-role">Staff:</div>
                                    <div class="member-name">${team.staff.name}</div>
                                </div>
                                `) : ''}
                        ${team.porters ? team.porters.map(porter => `
                            <div class="member-item">
                                <div class="member-role">Porter:</div>
                                <div class="member-name">${porter.name}</div>
                            </div>
                        `).join('') : ''}
                        ${team.forkliftOperator ? `
                            <div class="member-item">
                                <div class="member-role">Forklift Operator:</div>
                                <div class="member-name">${team.forkliftOperator.name}</div>
                            </div>
                        ` : ''}
                        ${team.forkliftOperators ? team.forkliftOperators.map(forklift => `
                            <div class="member-item">
                                <div class="member-role">Forklift Operator:</div>
                                <div class="member-name">${forklift.name}</div>
                            </div>
                        `).join('') : ''}
                    </div>
                `;
                
                container.appendChild(teamCard);
                
                // Animate each card with a delay
                setTimeout(() => {
                    teamCard.classList.add('visible');
                }, index * 100);
            });
        }

        // Format time for display (HH:MM AM/PM)
        function formatTime(timeString) {
            if (!timeString) return '';
            
            const [hours, minutes] = timeString.split(':');
            const hourNum = parseInt(hours, 10);
            const period = hourNum >= 12 ? 'PM' : 'AM';
            const displayHour = hourNum % 12 || 12;
            
            return `${displayHour}:${minutes} ${period}`;
        }

        // Calculate duration between two times
        function calculateDuration(startTime, endTime) {
            if (!startTime || !endTime) return '';
            
            const [startHours, startMinutes] = startTime.split(':').map(Number);
            const [endHours, endMinutes] = endTime.split(':').map(Number);
            
            let totalMinutes = (endHours * 60 + endMinutes) - (startHours * 60 + startMinutes);
            
            if (totalMinutes < 0) {
                totalMinutes += 24 * 60; // Handle overnight breaks
            }
            
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            
            return `${hours > 0 ? hours + 'h ' : ''}${minutes}m`;
        }

        // Start checking for break times
        function startBreakCheck() {
            if (breakCheckInterval) {
                clearInterval(breakCheckInterval);
            }
            
            // Check every minute
            breakCheckInterval = setInterval(checkBreakTimes, 60000);
            
            // Initial check
            checkBreakTimes();
        }

        // Check if any breaks are ending soon or have ended
        function checkBreakTimes() {
            const now = new Date();
            const currentHours = now.getHours().toString().padStart(2, '0');
            const currentMinutes = now.getMinutes().toString().padStart(2, '0');
            const currentTime = `${currentHours}:${currentMinutes}`;
            
            const user = auth.currentUser;
            if (!user) return;
            
            const currentUserId = user.email.split('@')[0];
            
            // Get all teams where the current user is a member
            const userTeams = teams.filter(team => isEmployeeInTeam(currentUserId, team));
            
            userTeams.forEach(team => {
                if (!team.breaks) return;
                
                // Check team breaks
                if (team.breaks.teamBreaks) {
                    team.breaks.teamBreaks.forEach((breakItem, index) => {
                        const breakKey = `team-${team.id}-${index}`;
                        
                        // Check if break is ending within 5 minutes or has just ended
                        if (isTimeWithinRange(currentTime, breakItem.end, 5) && !alertedBreaks.has(breakKey)) {
                            alertedBreaks.add(breakKey);
                            showBreakAlert(
                                `Team Break Ending Soon`, 
                                `Team ${team.name}'s break is ending at ${formatTime(breakItem.end)}`,
                                'team'
                            );
                        }
                    });
                }
                
                // Check individual breaks for this user
                if (team.breaks.individualBreaks) {
                    team.breaks.individualBreaks.forEach((breakItem, index) => {
                        if (breakItem.employeeId === currentUserId) {
                            const breakKey = `individual-${team.id}-${index}`;
                            
                            // Check if break is ending within 5 minutes or has just ended
                            if (isTimeWithinRange(currentTime, breakItem.end, 5) && !alertedBreaks.has(breakKey)) {
                                alertedBreaks.add(breakKey);
                                showBreakAlert(
                                    `Your Break Ending Soon`, 
                                    `Your break is ending at ${formatTime(breakItem.end)} (Team: ${team.name})`,
                                    'individual'
                                );
                            }
                        }
                    });
                }
            });
        }

        // Check if time is within range of target time (in minutes)
        function isTimeWithinRange(currentTime, targetTime, rangeMinutes) {
            const [currentH, currentM] = currentTime.split(':').map(Number);
            const [targetH, targetM] = targetTime.split(':').map(Number);
            
            const currentTotal = currentH * 60 + currentM;
            const targetTotal = targetH * 60 + targetM;
            
            // Check if current time is within rangeMinutes of target time
            return Math.abs(currentTotal - targetTotal) <= rangeMinutes;
        }

        // Show break alert - Updated to show centered modal with close button
        function showBreakAlert(title, message, type) {
            // Create the alert overlay
            const alertOverlay = document.createElement('div');
            alertOverlay.className = 'break-alert-overlay';
            
            // Create the alert container
            const breakAlert = document.createElement('div');
            breakAlert.className = 'break-alert-modal';
            
            // Set icon based on alert type
            const icon = type === 'team' ? 'fa-users' : 'fa-user';
            
            breakAlert.innerHTML = `
                <div class="break-alert-content">
                    <div class="break-alert-header">
                        <div class="break-alert-icon">
                            <i class="fas ${icon}"></i>
                        </div>
                        <h3>${title}</h3>
                    </div>
                    <div class="break-alert-body">
                        <p>${message}</p>
                    </div>
                    <div class="break-alert-footer">
                        <button class="break-alert-close-btn ripple">Got it!</button>
                    </div>
                </div>
            `;
            
            // Add to DOM
            alertOverlay.appendChild(breakAlert);
            document.body.appendChild(alertOverlay);
            
            // Play notification sound
            const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3');
            audio.play().catch(e => console.log('Audio play failed:', e));
            
            // Add close functionality
            const closeBtn = breakAlert.querySelector('.break-alert-close-btn');
            closeBtn.addEventListener('click', () => {
                // Animate out
                breakAlert.style.animation = 'fadeOut 0.3s forwards';
                alertOverlay.style.animation = 'fadeOut 0.3s forwards';
                
                // Remove after animation
                setTimeout(() => {
                    alertOverlay.remove();
                }, 300);
            });
            
            // Auto-remove after 30 seconds
            const autoCloseTimer = setTimeout(() => {
                closeBtn.click();
            }, 30000);
            
            // Clear timer if manually closed
            closeBtn.addEventListener('click', () => {
                clearTimeout(autoCloseTimer);
            });
            
            // Add animation class after a short delay to trigger the animation
            setTimeout(() => {
                breakAlert.classList.add('show');
                alertOverlay.classList.add('show');
            }, 50);
        }

        // Chat modal functionality
        const chatModal = document.getElementById('chatModal');
        const chatBackBtn = document.getElementById('chatBackBtn');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const chatSendBtn = document.getElementById('chatSendBtn');
        const chatForumTitle = document.getElementById('chatForumTitle');
        const fileUploadBtn = document.getElementById('fileUploadBtn');
        const fileUploadInput = document.getElementById('fileUploadInput');
        const cameraUploadBtn = document.getElementById('cameraUploadBtn');
        const voiceRecordBtn = document.getElementById('voiceRecordBtn');
        const recordingIndicator = document.getElementById('recordingIndicator');
        
        let currentForumId = null;
        let currentForumName = '';
        let unsubscribeMessages = null;
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;

        // Chat back button functionality
        chatBackBtn.addEventListener('click', function() {
            chatModal.classList.remove('active');
            if (unsubscribeMessages) {
                unsubscribeMessages();
                unsubscribeMessages = null;
            }
        });

        // Camera functionality
        const cameraModal = document.getElementById('cameraModal');
        const cameraVideo = document.getElementById('cameraVideo');
        const cameraCloseBtn = document.getElementById('cameraCloseBtn');
        const cameraCaptureBtn = document.getElementById('cameraCaptureBtn');
        const cameraFlipBtn = document.getElementById('cameraFlipBtn');
        const cameraPreview = document.getElementById('cameraPreview');
        const cameraPreviewImg = document.getElementById('cameraPreviewImg');
        const cameraPreviewRetake = document.getElementById('cameraPreviewRetake');
        const cameraPreviewAccept = document.getElementById('cameraPreviewAccept');
        
        let stream = null;
        let facingMode = "user"; // front camera by default

        // Open camera modal
        cameraUploadBtn.addEventListener('click', async function() {
            try {
                // Stop any existing stream
                if (stream) {
                    stream.getTracks().forEach(track => track.stop());
                }
                
                // Get camera stream
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: facingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: false
                });
                
                cameraVideo.srcObject = stream;
                cameraModal.classList.add('active');
            } catch (error) {
                console.error('Error accessing camera:', error);
                alert('Could not access camera. Please check permissions.');
            }
        });

        // Close camera modal
        cameraCloseBtn.addEventListener('click', function() {
            cameraModal.classList.remove('active');
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
        });

        // Flip camera
        cameraFlipBtn.addEventListener('click', function() {
            facingMode = facingMode === "user" ? "environment" : "user";
            // Restart camera with new facing mode
            cameraUploadBtn.click();
        });

        // Capture photo
        cameraCaptureBtn.addEventListener('click', function() {
            const canvas = document.createElement('canvas');
            canvas.width = cameraVideo.videoWidth;
            canvas.height = cameraVideo.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(cameraVideo, 0, 0, canvas.width, canvas.height);
            
            cameraPreviewImg.src = canvas.toDataURL('image/jpeg');
            cameraModal.classList.remove('active');
            cameraPreview.classList.add('active');
            
            // Stop camera stream
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
        });

        // Retake photo
        cameraPreviewRetake.addEventListener('click', function() {
            cameraPreview.classList.remove('active');
            cameraUploadBtn.click();
        });

        // Accept photo and upload
        cameraPreviewAccept.addEventListener('click', function() {
            cameraPreview.classList.remove('active');
            
            // Convert data URL to blob
            fetch(cameraPreviewImg.src)
                .then(res => res.blob())
                .then(blob => {
                    // Create a file from the blob
                    const file = new File([blob], `photo_${Date.now()}.jpg`, { type: 'image/jpeg' });
                    uploadFile(file);
                });
        });

        // Voice recording functionality
        voiceRecordBtn.addEventListener('click', toggleRecording);

        async function toggleRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    startRecording(stream);
                } catch (error) {
                    console.error('Error accessing microphone:', error);
                    alert('Could not access microphone. Please check permissions.');
                }
            }
        }

        function startRecording(stream) {
            isRecording = true;
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];
            
            voiceRecordBtn.classList.add('recording');
            recordingIndicator.style.display = 'flex';
            
            mediaRecorder.ondataavailable = event => {
                audioChunks.push(event.data);
            };
            
            mediaRecorder.onstop = async () => {
                const audioBlob = new Blob(audioChunks, { type: 'audio/mp3' });
                await uploadAudio(audioBlob);
            };
            
            mediaRecorder.start();
            
            // Stop recording after 2 minutes (safety limit)
            setTimeout(() => {
                if (isRecording) {
                    stopRecording();
                }
            }, 120000);
        }

        function stopRecording() {
            if (!isRecording) return;
            
            isRecording = false;
            mediaRecorder.stop();
            voiceRecordBtn.classList.remove('recording');
            recordingIndicator.style.display = 'none';
            
            // Stop all tracks in the stream
            mediaRecorder.stream.getTracks().forEach(track => track.stop());
        }

        async function uploadAudio(audioBlob) {
            if (!currentForumId || audioBlob.size === 0) return;
            
            const user = auth.currentUser;
            if (!user) return;
            
            const username = user.email.split('@')[0];
            const timestamp = firebase.firestore.FieldValue.serverTimestamp();
            
            // Create a unique filename
            const uniqueFilename = `audio_${Date.now()}.mp3`;
            const storageRef = storage.ref(`forum_audio/${currentForumId}/${uniqueFilename}`);
            
            try {
                // Show uploading indicator
                const originalBtnText = voiceRecordBtn.innerHTML;
                voiceRecordBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                voiceRecordBtn.disabled = true;
                
                // Upload audio file
                const uploadTask = storageRef.put(audioBlob);
                
                await new Promise((resolve, reject) => {
                    uploadTask.on('state_changed',
                        null,
                        error => reject(error),
                        () => resolve()
                    );
                });
                
                // Get download URL
                const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                
                // Save audio info to Firestore
                if (currentForumId.includes('_')) {
                    // Private chat
                    await db.collection('privateChats').doc(currentForumId).collection('messages').add({
                        audio: {
                            url: downloadURL,
                            duration: Math.floor(audioBlob.size / 6000) // Rough estimate in seconds
                        },
                        sender: username,
                        timestamp: timestamp
                    });
                } else {
                    // Forum chat
                    await db.collection('chatForums').doc(currentForumId).collection('messages').add({
                        audio: {
                            url: downloadURL,
                            duration: Math.floor(audioBlob.size / 6000) // Rough estimate in seconds
                        },
                        sender: username,
                        timestamp: timestamp
                    });
                }
                
            } catch (error) {
                console.error('Error uploading audio:', error);
                alert('Error uploading voice message. Please try again.');
            } finally {
                // Reset button
                voiceRecordBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                voiceRecordBtn.disabled = false;
            }
        }

        // File upload functionality
        fileUploadBtn.addEventListener('click', function() {
            fileUploadInput.click();
        });

        fileUploadInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                alert('File size too large. Maximum size is 5MB.');
                return;
            }

            uploadFile(file);
        });

        function uploadFile(file) {
            const user = auth.currentUser;
            if (!user || !currentForumId) return;

            const username = user.email.split('@')[0];
            const timestamp = firebase.firestore.FieldValue.serverTimestamp();
            
            // Create a unique filename to prevent overwrites
            const uniqueFilename = Date.now() + '_' + file.name;
            let storageRef;
            
            if (currentForumId.includes('_')) {
                // Private chat
                storageRef = storage.ref(`private_chat_files/${currentForumId}/${uniqueFilename}`);
            } else {
                // Forum chat
                storageRef = storage.ref(`forum_files/${currentForumId}/${uniqueFilename}`);
            }
            
            const uploadTask = storageRef.put(file);

            uploadTask.on('state_changed', 
                (snapshot) => {
                    // Progress monitoring can be added here
                    const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                    console.log('Upload is ' + progress + '% done');
                }, 
                (error) => {
                    console.error('Error uploading file:', error);
                    alert('Error uploading file. Please try again.');
                }, 
                () => {
                    uploadTask.snapshot.ref.getDownloadURL().then((downloadURL) => {
                        // Save file info to Firestore
                        let savePromise;
                        
                        if (currentForumId.includes('_')) {
                            savePromise = db.collection('privateChats').doc(currentForumId).collection('messages').add({
                                file: {
                                    url: downloadURL,
                                    type: file.type,
                                    size: file.size
                                },
                                sender: username,
                                timestamp: timestamp
                            });
                        } else {
                            savePromise = db.collection('chatForums').doc(currentForumId).collection('messages').add({
                                file: {
                                    url: downloadURL,
                                    type: file.type,
                                    size: file.size
                                },
                                sender: username,
                                timestamp: timestamp
                            });
                        }
                        
                        savePromise.then(() => {
                            // Clear the file input
                            fileUploadInput.value = '';
                        })
                        .catch(error => {
                            console.error('Error saving file info:', error);
                            alert('Error saving file information. Please try again.');
                        });
                    });
                }
            );
        }

        // Send message functionality
        chatSendBtn.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        function sendMessage() {
            const messageText = chatInput.value.trim();
            if (!messageText || !currentForumId) return;

            const user = auth.currentUser;
            if (!user) return;

            const username = user.email.split('@')[0];
            const timestamp = firebase.firestore.FieldValue.serverTimestamp();

            let savePromise;
            
            if (currentForumId.includes('_')) {
                savePromise = db.collection('privateChats').doc(currentForumId).collection('messages').add({
                    text: messageText,
                    sender: username,
                    timestamp: timestamp
                });
            } else {
                savePromise = db.collection('chatForums').doc(currentForumId).collection('messages').add({
                    text: messageText,
                    sender: username,
                    timestamp: timestamp
                });
            }
            
            savePromise.then(() => {
                chatInput.value = '';
            })
            .catch(error => {
                console.error('Error sending message:', error);
                alert('Error sending message. Please try again.');
            });
        }

        // Open chat forum
        function openChatForum(forumId, forumName) {
            currentForumId = forumId;
            currentForumName = forumName;
            chatForumTitle.textContent = forumName;
            chatModal.classList.add('active');
            chatMessages.innerHTML = '<div class="no-messages">Loading messages...</div>';

            // Load messages
            loadForumMessages(forumId);
        }

        // Load forum messages
        function loadForumMessages(forumId) {
            if (unsubscribeMessages) {
                unsubscribeMessages();
            }

            const messagesQuery = db.collection('chatForums').doc(forumId)
                .collection('messages')
                .orderBy('timestamp', 'asc')
                .limit(100);

            unsubscribeMessages = messagesQuery.onSnapshot(snapshot => {
                if (snapshot.empty) {
                    chatMessages.innerHTML = '<div class="no-messages">No messages yet. Be the first to say something!</div>';
                    return;
                }

                chatMessages.innerHTML = '';
                const user = auth.currentUser;
                const currentUser = user ? user.email.split('@')[0] : null;

                snapshot.forEach(doc => {
                    const message = doc.data();
                    const messageElement = createMessageElement(message, currentUser, doc.id);
                    chatMessages.appendChild(messageElement);
                });

                // Scroll to bottom with smooth behavior
                setTimeout(() => {
                    chatMessages.scrollTo({
                        top: chatMessages.scrollHeight,
                        behavior: 'smooth'
                    });
                }, 100);
            }, error => {
                console.error('Error loading messages:', error);
                chatMessages.innerHTML = '<div class="no-messages">Error loading messages. Please try again.</div>';
            });
        }

        // Create message element
        function createMessageElement(message, currentUser, messageId) {
            const isCurrentUser = message.sender === currentUser;
            const messageClass = isCurrentUser ? 'message message-sent' : 'message message-received';
            
            const date = message.timestamp?.toDate() || new Date();
            const formattedTime = date.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });

            const messageElement = document.createElement('div');
            messageElement.className = messageClass;
            
            // Get sender's avatar
            const avatarUrl = getAvatarUrl(message.sender);
            
            let messageContent = '';
            if (message.text) {
                messageContent += `<div class="message-content">${message.text}</div>`;
            }
            
            if (message.file) {
                if (message.file.type.startsWith('image/')) {
                    messageContent += `
                        <div class="file-message">
                            <i class="fas fa-image"></i> Image Attachment
                            <img src="${message.file.url}" alt="Image Attachment" class="file-preview">
                            <div class="file-actions">
                                <div class="file-action" onclick="window.open('${message.file.url}', '_blank')">
                                    <i class="fas fa-download"></i> Download
                                </div>
                                ${isCurrentUser ? `
                                <div class="file-action" onclick="deleteFileAttachment('${currentForumId}', '${messageId}', '${message.file.url}', ${currentForumId.includes('_')})">
                                    <i class="fas fa-trash"></i> Delete
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                } else {
                    messageContent += `
                        <div class="file-message">
                            <i class="fas fa-file"></i> File Attachment
                            <div class="file-actions">
                                <div class="file-action" onclick="window.open('${message.file.url}', '_blank')">
                                    <i class="fas fa-download"></i> Download
                                </div>
                                ${isCurrentUser ? `
                                <div class="file-action" onclick="deleteFileAttachment('${currentForumId}', '${messageId}', '${message.file.url}', ${currentForumId.includes('_')})">
                                    <i class="fas fa-trash"></i> Delete
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                }
            }
            
            if (message.audio) {
                messageContent += `
                    <div class="audio-message">
                        <i class="fas fa-microphone"></i>
                        <audio controls class="audio-player">
                            <source src="${message.audio.url}" type="audio/mp3">
                            Your browser does not support the audio element.
                        </audio>
                        ${isCurrentUser ? `
                        <div class="file-action" onclick="deleteFileAttachment('${currentForumId}', '${messageId}', '${message.audio.url}', ${currentForumId.includes('_')})">
                            <i class="fas fa-trash"></i> Delete
                        </div>
                        ` : ''}
                    </div>
                `;
            }
            
            messageElement.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar" style="background-image: url('${avatarUrl}')"></div>
                    <div class="message-info">
                        <div class="message-sender">${message.sender}</div>
                        <div class="message-time">${formattedTime}</div>
                    </div>
                </div>
                ${messageContent}
                ${isCurrentUser ? `
                <div class="message-actions">
                    <div class="message-action" onclick="editMessage('${currentForumId}', '${messageId}', '${message.text || ''}', ${currentForumId.includes('_')})">
                        <i class="fas fa-edit"></i>
                    </div>
                    <div class="message-action" onclick="deleteMessage('${currentForumId}', '${messageId}', ${currentForumId.includes('_')})">
                        <i class="fas fa-trash"></i>
                    </div>
                </div>
                ` : ''}
            `;
            
            return messageElement;
        }

        // Delete message
        window.deleteMessage = function(forumId, messageId, isPrivateChat) {
            if (confirm('Are you sure you want to delete this message?')) {
                let deletePromise;
                
                if (isPrivateChat) {
                    deletePromise = db.collection('privateChats').doc(forumId).collection('messages').doc(messageId).delete();
                } else {
                    deletePromise = db.collection('chatForums').doc(forumId).collection('messages').doc(messageId).delete();
                }
                
                deletePromise.then(() => {
                    console.log('Message deleted successfully');
                })
                .catch(error => {
                    console.error('Error deleting message:', error);
                    alert('Error deleting message. Please try again.');
                });
            }
        };

        // Edit message
        window.editMessage = function(forumId, messageId, currentText, isPrivateChat) {
            const newText = prompt('Edit your message:', currentText);
            if (newText !== null && newText !== currentText) {
                let updatePromise;
                
                if (isPrivateChat) {
                    updatePromise = db.collection('privateChats').doc(forumId).collection('messages').doc(messageId).update({
                        text: newText,
                        edited: true
                    });
                } else {
                    updatePromise = db.collection('chatForums').doc(forumId).collection('messages').doc(messageId).update({
                        text: newText,
                        edited: true
                    });
                }
                
                updatePromise.then(() => {
                    console.log('Message updated successfully');
                })
                .catch(error => {
                    console.error('Error updating message:', error);
                    alert('Error updating message. Please try again.');
                });
            }
        };

        // Delete file attachment
        window.deleteFileAttachment = function(forumId, messageId, fileUrl, isPrivateChat) {
            if (confirm('Are you sure you want to delete this attachment?')) {
                // Delete from storage first
                const fileRef = storage.refFromURL(fileUrl);
                
                fileRef.delete().then(() => {
                    // Then delete the message or update it in Firestore
                    let deletePromise;
                    
                    if (isPrivateChat) {
                        deletePromise = db.collection('privateChats').doc(forumId).collection('messages').doc(messageId).delete();
                    } else {
                        deletePromise = db.collection('chatForums').doc(forumId).collection('messages').doc(messageId).delete();
                    }
                    
                    return deletePromise;
                })
                .then(() => {
                    console.log('File attachment deleted successfully');
                })
                .catch(error => {
                    console.error('Error deleting file attachment:', error);
                    alert('Error deleting file attachment. Please try again.');
                });
            }
        };

        // Get avatar URL for a user
        function getAvatarUrl(username) {
            // In a real app, you would fetch this from the user's profile in Firestore
            // For now, we'll use a placeholder or check if we have it in localStorage
            const cachedAvatar = localStorage.getItem(`avatar_${username}`);
            return cachedAvatar || 'https://via.placeholder.com/150?text=' + username.charAt(0);
        }

        // Load chat forums
        function loadChatForums() {
            const forumsBody = document.getElementById('forumsBody');
            forumsBody.innerHTML = '<div class="no-teams">Loading chat forums...</div>';
            
            const user = auth.currentUser;
            if (!user) return;
            
            const username = user.email.split('@')[0];
            
            db.collection('chatForums')
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    if (snapshot.empty) {
                        forumsBody.innerHTML = '<div class="no-teams">No chat forums available.</div>';
                        return;
                    }
                    
                    forumsBody.innerHTML = '';
                    
                    snapshot.forEach((doc, index) => {
                        const forum = doc.data();
                        const forumId = doc.id;
                        const isMember = forum.members && forum.members.includes(username);
                        
                        const forumCard = document.createElement('div');
                        forumCard.className = 'forum-card';
                        forumCard.innerHTML = `
                            <div class="forum-header">
                                <div class="forum-title">${forum.name}</div>
                                <div class="forum-members">
                                    <i class="fas fa-users"></i> ${forum.memberCount || 0} members
                                </div>
                            </div>
                            <div class="forum-description">${forum.description || 'Join this forum to connect with colleagues'}</div>
                            <div class="forum-footer">
                                <div class="forum-category">${forum.category || 'General'}</div>
                                ${isMember ? 
                                    `<button class="forum-join-btn" data-forum-id="${forumId}" data-forum-name="${forum.name}" style="background-color: var(--success);">Open Chat</button>
                                     <button class="forum-exit-btn" data-forum-id="${forumId}">Exit Forum</button>` : 
                                    `<button class="forum-join-btn" data-forum-id="${forumId}">Join Forum</button>`}
                            </div>
                        `;
                        
                        forumsBody.appendChild(forumCard);
                        
                        // Animate each card with a delay
                        setTimeout(() => {
                            forumCard.classList.add('visible');
                        }, index * 100);
                    });
                    
                    // Add event listeners to join buttons
                    document.querySelectorAll('.forum-join-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const forumId = this.getAttribute('data-forum-id');
                            const forumName = this.getAttribute('data-forum-name');
                            
                            if (this.textContent === 'Open Chat') {
                                openChatForum(forumId, forumName);
                            } else {
                                joinChatForum(forumId);
                            }
                            
                            // Micro-interaction
                            this.style.transform = 'scale(0.95)';
                            setTimeout(() => {
                                this.style.transform = 'scale(1)';
                            }, 200);
                        });
                    });
                    
                    // Add event listeners to exit buttons
                    document.querySelectorAll('.forum-exit-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const forumId = this.getAttribute('data-forum-id');
                            exitChatForum(forumId);
                            
                            // Micro-interaction
                            this.style.transform = 'scale(0.95)';
                            setTimeout(() => {
                                this.style.transform = 'scale(1)';
                            }, 200);
                        });
                    });
                })
                .catch(error => {
                    console.error('Error loading forums:', error);
                    forumsBody.innerHTML = '<div class="no-teams">Error loading chat forums. Please try again later.</div>';
                });
        }

        // Join a chat forum
        function joinChatForum(forumId) {
            const user = auth.currentUser;
            if (!user) return;
            
            const username = user.email.split('@')[0];
            
            // Add user to forum members
            db.collection('chatForums').doc(forumId).update({
                members: firebase.firestore.FieldValue.arrayUnion(username),
                memberCount: firebase.firestore.FieldValue.increment(1)
            })
            .then(() => {
                // Show success animation
                const joinBtn = document.querySelector(`.forum-join-btn[data-forum-id="${forumId}"]`);
                if (joinBtn) {
                    joinBtn.innerHTML = '<i class="fas fa-check"></i> Joined';
                    joinBtn.style.backgroundColor = 'var(--success)';
                    
                    setTimeout(() => {
                        joinBtn.innerHTML = 'Open Chat';
                        loadChatForums(); // Refresh the list
                    }, 1000);
                }
            })
            .catch(error => {
                console.error('Error joining forum:', error);
                alert('Error joining forum. Please try again.');
            });
        }

        // Exit a chat forum
        function exitChatForum(forumId) {
            const user = auth.currentUser;
            if (!user) return;
            
            const username = user.email.split('@')[0];
            
            if (confirm('Are you sure you want to exit this forum?')) {
                // Remove user from forum members
                db.collection('chatForums').doc(forumId).update({
                    members: firebase.firestore.FieldValue.arrayRemove(username),
                    memberCount: firebase.firestore.FieldValue.increment(-1)
                })
                .then(() => {
                    loadChatForums(); // Refresh the list
                })
                .catch(error => {
                    console.error('Error exiting forum:', error);
                    alert('Error exiting forum. Please try again.');
                });
            }
        }

        // Profile avatar upload
        const profileAvatar = document.getElementById('profileAvatar');
        const profileAvatarEdit = document.getElementById('profileAvatarEdit');
        const profileAvatarInput = document.getElementById('profileAvatarInput');
        
        profileAvatarEdit.addEventListener('click', function() {
            profileAvatarInput.click();
        });
        
        profileAvatarInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file');
                return;
            }
            
            const user = auth.currentUser;
            if (!user) return;
            
            const username = user.email.split('@')[0];
            const storageRef = storage.ref(`avatars/${username}`);
            
            // Show loading state
            const originalContent = profileAvatarEdit.innerHTML;
            profileAvatarEdit.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            // Upload file
            storageRef.put(file)
                .then(snapshot => {
                    return snapshot.ref.getDownloadURL();
                })
                .then(downloadURL => {
                    // Update user's avatar in Firestore
                    return db.collection('employees').doc(username).update({
                        avatarUrl: downloadURL
                    });
                })
                .then(() => {
                    // Update avatar display
                    profileAvatar.style.backgroundImage = `url('${URL.createObjectURL(file)}')`;
                    
                    // Cache the avatar URL locally
                    localStorage.setItem(`avatar_${username}`, URL.createObjectURL(file));
                    
                    // Update avatar in dashboard
                    document.getElementById('userAvatar').style.backgroundImage = `url('${URL.createObjectURL(file)}')`;
                    headerUserAvatar.style.backgroundImage = `url('${URL.createObjectURL(file)}')`;
                    headerUserAvatar.textContent = '';
                })
                .catch(error => {
                    console.error('Error uploading avatar:', error);
                    alert('Error uploading avatar. Please try again.');
                })
                .finally(() => {
                    profileAvatarEdit.innerHTML = originalContent;
                });
        });

        // Login form submission
        const loginForm = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn');
        const btnText = document.getElementById('btnText');
        const btnSpinner = document.getElementById('btnSpinner');
        const temporaryPasswordAlert = document.getElementById('temporaryPasswordAlert');
        const disabledAccountAlert = document.getElementById('disabledAccountAlert');
        const loginContainer = document.getElementById('loginContainer');
        const dashboardContainer = document.getElementById('dashboardContainer');
        const logoutBtn = document.getElementById('logoutBtn');
        const userAvatar = document.getElementById('userAvatar');
        const teamsList = document.getElementById('teamsList');
        const announcementsBody = document.getElementById('announcementsBody');
        const dashboardIconsContainer = document.getElementById('dashboardIconsContainer');
        
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Show loading state
            btnText.textContent = 'Authenticating...';
            btnSpinner.style.display = 'inline-block';
            loginBtn.disabled = true;
            temporaryPasswordAlert.style.display = 'none';
            disabledAccountAlert.style.display = 'none';
            
            // Sign in with email and password
            auth.signInWithEmailAndPassword(`${username}@dnata.com`, password)
                .then((userCredential) => {
                    // Check if account is disabled
                    if (userCredential.user.disabled) {
                        auth.signOut();
                        disabledAccountAlert.style.display = 'flex';
                        return;
                    }
                    
                    // Check if this is the first login (temporary password)
                    return db.collection('employees').doc(username).get()
                        .then((doc) => {
                            if (doc.exists && doc.data().passwordChanged === false) {
                                // Show temporary password alert
                                temporaryPasswordAlert.style.display = 'flex';
                                
                                // Show change password modal
                                modal.classList.add('active');
                            } else {
                                // Successful login - show dashboard
                                showDashboard(userCredential.user);
                            }
                        });
                })
                .catch((error) => {
                    // Handle errors
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    
                    if (errorCode === 'auth/user-not-found') {
                        alert('Employee ID not found. Please check your ID and try again.');
                    } else if (errorCode === 'auth/wrong-password') {
                        alert('Incorrect password. Please try again.');
                    } else if (errorCode === 'auth/user-disabled') {
                        disabledAccountAlert.style.display = 'flex';
                    } else {
                        alert('Login error: ' + errorMessage);
                    }
                })
                .finally(() => {
                    // Reset button state
                    btnText.textContent = 'Sign In';
                    btnSpinner.style.display = 'none';
                    loginBtn.disabled = false;
                });
        });

        // Show dashboard after successful login
        function showDashboard(user) {
            // Animate login container out
            loginContainer.classList.add('hidden');
            
            // After animation completes, show dashboard
            setTimeout(() => {
                loginContainer.style.display = 'none';
                dashboardContainer.classList.add('active');
                dashboardIconsContainer.classList.remove('hidden');
                
                // Show fixed header with glass effect
                fixedHeader.classList.add('visible');
                
                // Set user avatar initials
                const email = user.email.split('@')[0];
                db.collection('employees').doc(email).get()
                    .then(doc => {
                        if (doc.exists) {
                            const employee = doc.data();
                            const initials = `${employee.firstName?.charAt(0) || ''}${employee.lastName?.charAt(0) || ''}`;
                            userAvatar.textContent = initials;
                            headerUserAvatar.textContent = initials;
                            
                            // Load avatar if available
                            if (employee.avatarUrl) {
                                userAvatar.style.backgroundImage = `url('${employee.avatarUrl}')`;
                                userAvatar.textContent = '';
                                headerUserAvatar.style.backgroundImage = `url('${employee.avatarUrl}')`;
                                headerUserAvatar.textContent = '';
                                localStorage.setItem(`avatar_${email}`, employee.avatarUrl);
                            }
                            
                            // Load profile info
                            document.getElementById('profileEmployeeId').textContent = email;
                            document.getElementById('profileName').textContent = `${employee.firstName || ''} ${employee.lastName || ''}`;
                            document.getElementById('profileDepartment').textContent = employee.department || 'Not specified';
                            document.getElementById('profilePosition').textContent = employee.position || 'Not specified';
                            
                            if (employee.avatarUrl) {
                                profileAvatar.style.backgroundImage = `url('${employee.avatarUrl}')`;
                                profileAvatar.textContent = '';
                            } else {
                                profileAvatar.style.backgroundImage = '';
                                profileAvatar.textContent = initials;
                            }
                            
                            // Load employee's teams and announcements
                            loadEmployeeTeams(email);
                            loadAnnouncements();
                        }
                    });
                    
                // Make user avatar clickable to show profile
                userAvatar.addEventListener('click', function() {
                    profileModal.classList.add('active');
                });

                // Make header avatar clickable to show profile
                headerUserAvatar.addEventListener('click', function() {
                    profileModal.classList.add('active');
                });
                
                // Animate dashboard sections in
                const sections = document.querySelectorAll('.dashboard-section');
                sections.forEach((section, index) => {
                    setTimeout(() => {
                        section.classList.add('visible');
                    }, index * 150);
                });
            }, 400);
        }

        // Logout functionality
        function logoutUser() {
            // Clear break check interval
            if (breakCheckInterval) {
                clearInterval(breakCheckInterval);
                breakCheckInterval = null;
            }
            
            // Clear alerted breaks
            alertedBreaks = new Set();
            
            // Animate dashboard out
            dashboardContainer.classList.remove('active');
            dashboardIconsContainer.classList.add('hidden');
            
            // Hide fixed header
            fixedHeader.classList.remove('visible');
            
            // After animation completes, show login
            setTimeout(() => {
                auth.signOut().then(() => {
                    dashboardContainer.style.display = 'none';
                    loginContainer.style.display = 'block';
                    document.getElementById('username').value = '';
                    document.getElementById('password').value = '';
                    
                    // Hide any open fullscreen content
                    hideFullscreenContent();
                    
                    // Hide chat modal if open
                    chatModal.classList.remove('active');
                    if (unsubscribeMessages) {
                        unsubscribeMessages();
                        unsubscribeMessages = null;
                    }
                    
                    // Animate login container back in
                    setTimeout(() => {
                        loginContainer.classList.remove('hidden');
                    }, 50);
                }).catch(error => {
                    console.error('Error signing out:', error);
                    alert('Error signing out. Please try again.');
                });
            }, 400);
        }

        // Logout button click handlers
        logoutBtn.addEventListener('click', logoutUser);
        headerLogoutBtn.addEventListener('click', logoutUser);

        // Change password form submission
        const changePasswordForm = document.getElementById('changePasswordForm');
        const submitNewPassword = document.getElementById('submitNewPassword');
        
        submitNewPassword.addEventListener('click', function() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const username = document.getElementById('username').value;
            
            // Validate inputs
            if (newPassword !== confirmPassword) {
                alert('New passwords do not match');
                return;
            }
            
            if (newPassword.length < 8) {
                alert('Password must be at least 8 characters long');
                return;
            }
            
            // Get current user
            const user = auth.currentUser;
            
            if (user) {
                // Reauthenticate with current password
                const credential = firebase.auth.EmailAuthProvider.credential(
                    `${username}@dnata.com`,
                    currentPassword
                );
                
                user.reauthenticateWithCredential(credential)
                    .then(() => {
                        // Update password
                        return user.updatePassword(newPassword);
                    })
                    .then(() => {
                        // Password updated successfully
                        alert('Password changed successfully!');
                        modal.classList.remove('active');
                        temporaryPasswordAlert.style.display = 'none';
                        
                        // Update user in Firestore
                        return db.collection('employees').doc(username).update({
                            passwordChanged: true,
                            lastPasswordChange: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    })
                    .then(() => {
                        // Show dashboard after password change
                        showDashboard(user);
                    })
                    .catch((error) => {
                        console.error('Error changing password:', error);
                        alert('Error changing password. Please try again.');
                    });
            } else {
                alert('No user is currently signed in');
            }
        });

        // Forgot password link
        document.getElementById('forgotPassword').addEventListener('click', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            
            if (!username) {
                alert('Please enter your Employee ID first');
                return;
            }
            
            const email = `${username}@dnata.com`;
            
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    alert('Password reset email sent. Please check your inbox.');
                })
                .catch((error) => {
                    console.error('Error sending password reset email:', error);
                    if (error.code === 'auth/user-not-found') {
                        alert('Employee ID not found. Please check your ID and try again.');
                    } else if (error.code === 'auth/user-disabled') {
                        alert('Your account has been disabled. Please contact HR.');
                    } else {
                        alert('Error sending password reset email. Please try again.');
                    }
                });
        });

        // Tooltip functionality for floating icons
        const floatingIcons = document.querySelectorAll('.floating-icon');
        floatingIcons.forEach(icon => {
            const tooltip = document.createElement('div');
            tooltip.className = 'tooltip';
            tooltip.textContent = icon.getAttribute('data-tooltip');
            icon.appendChild(tooltip);
            
            icon.addEventListener('mouseenter', function() {
                tooltip.style.visibility = 'visible';
                tooltip.style.opacity = '1';
            });
            
            icon.addEventListener('mouseleave', function() {
                tooltip.style.visibility = 'hidden';
                tooltip.style.opacity = '0';
            });
        });

        // Tooltip functionality for dashboard icons
        const dashboardIcons = document.querySelectorAll('.dashboard-icon');
        dashboardIcons.forEach(icon => {
            const tooltip = icon.querySelector('.dashboard-icon-tooltip');
            
            icon.addEventListener('mouseenter', function() {
                tooltip.style.visibility = 'visible';
                tooltip.style.opacity = '1';
            });
            
            icon.addEventListener('mouseleave', function() {
                tooltip.style.visibility = 'hidden';
                tooltip.style.opacity = '0';
            });
        });

        // Check if user is already logged in
        auth.onAuthStateChanged((user) => {
            if (user) {
                // Check if account is disabled
                if (user.disabled) {
                    disabledAccountAlert.style.display = 'flex';
                    auth.signOut();
                    return;
                }
                
                // User is signed in, check if password needs to be changed
                const username = user.email.split('@')[0];
                db.collection('employees').doc(username).get()
                    .then((doc) => {
                        if (doc.exists) {
                            const employeeData = doc.data();
                            if (employeeData.passwordChanged === false) {
                                // Show password change modal
                                document.getElementById('username').value = username;
                                temporaryPasswordAlert.style.display = 'flex';
                                modal.classList.add('active');
                            } else {
                                // Show dashboard
                                showDashboard(user);
                            }
                        }
                    });
            } else {
                // Hide dashboard floating icons when logged out
                hideFullscreenContent();
            }
        });

        // Initially hide the fixed header
        fixedHeader.style.display = 'none';
        globalBackButton.style.display = 'none';
    });
</script>
</body>
</html>
